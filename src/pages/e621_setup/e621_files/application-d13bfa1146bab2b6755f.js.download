var Danbooru;!function(){var t,e={5052:function(t,e,a){var n={"./artist.js":3923,"./autocomplete.js.erb":5903,"./blacklists.js":2666,"./blips.js":2707,"./comments.js":5506,"./common.js":2389,"./cookie.js":8437,"./dtext.js":6501,"./favorites.js":8565,"./forum_posts.js":1462,"./guest_warning.js":2252,"./janitor_trials.js":253,"./local_storage.js":5669,"./mascots.js":6195,"./mod_queue.js":640,"./news_updates.js":5468,"./notes.js":8555,"./pools.js":8841,"./post_delete.js":3136,"./post_mode_menu.js":8764,"./post_sets.js":3529,"./post_versions.js":5597,"./posts.js":3263,"./related_tag.js":3107,"./replacement_uploader.js":2546,"./responsive.js":5462,"./send_queue.js":9633,"./shortcuts.js":8941,"./tag_relationships.js":5771,"./tag_script.js":3966,"./takedowns.js":5327,"./thumbnails.js":2363,"./ugoira.js":3236,"./uploader.js":9832,"./uploads.js":4821,"./user_feedback.js":3226,"./user_warning.js":7540,"./utility.js":8505,"./vote_manager.js":238,"src/javascripts/artist.js":3923,"src/javascripts/autocomplete.js.erb":5903,"src/javascripts/blacklists.js":2666,"src/javascripts/blips.js":2707,"src/javascripts/comments.js":5506,"src/javascripts/common.js":2389,"src/javascripts/cookie.js":8437,"src/javascripts/dtext.js":6501,"src/javascripts/favorites.js":8565,"src/javascripts/forum_posts.js":1462,"src/javascripts/guest_warning.js":2252,"src/javascripts/janitor_trials.js":253,"src/javascripts/local_storage.js":5669,"src/javascripts/mascots.js":6195,"src/javascripts/mod_queue.js":640,"src/javascripts/news_updates.js":5468,"src/javascripts/notes.js":8555,"src/javascripts/pools.js":8841,"src/javascripts/post_delete.js":3136,"src/javascripts/post_mode_menu.js":8764,"src/javascripts/post_sets.js":3529,"src/javascripts/post_versions.js":5597,"src/javascripts/posts.js":3263,"src/javascripts/related_tag.js":3107,"src/javascripts/replacement_uploader.js":2546,"src/javascripts/responsive.js":5462,"src/javascripts/send_queue.js":9633,"src/javascripts/shortcuts.js":8941,"src/javascripts/tag_relationships.js":5771,"src/javascripts/tag_script.js":3966,"src/javascripts/takedowns.js":5327,"src/javascripts/thumbnails.js":2363,"src/javascripts/ugoira.js":3236,"src/javascripts/uploader.js":9832,"src/javascripts/uploads.js":4821,"src/javascripts/user_feedback.js":3226,"src/javascripts/user_warning.js":7540,"src/javascripts/utility.js":8505,"src/javascripts/vote_manager.js":238};function i(t){var e=o(t);return a(e)}function o(t){if(!a.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}i.keys=function(){return Object.keys(n)},i.resolve=o,t.exports=i,i.id=5052},4386:function(t,e,a){var n={"./jquery-hotkeys.js":6989,"./pixiv-ugoira-player.js":1995,"./stupidtable.js":3080,"vendor/jquery-hotkeys.js":6989,"vendor/pixiv-ugoira-player.js":1995,"vendor/stupidtable.js":3080};function i(t){var e=o(t);return a(e)}function o(t){if(!a.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}i.keys=function(){return Object.keys(n)},i.resolve=o,t.exports=i,i.id=4386},8818:function(t,e,a){"use strict";a.r(e),a.d(e,{Artist:function(){return n.default},Autocomplete:function(){return i.default},Blacklist:function(){return o.default},Blip:function(){return r.default},Comment:function(){return s.default},DText:function(){return l.default},Note:function(){return c.default},Post:function(){return d.default},PostDeletion:function(){return u.default},PostModeMenu:function(){return p.default},PostVersions:function(){return f.default},RelatedTag:function(){return g.default},Shortcuts:function(){return h.default},Upload:function(){return v.default},Utility:function(){return m.default},Ugoira:function(){return _.default},TagRelationships:function(){return w.default},Takedown:function(){return b.default},Thumbnails:function(){return y.default},Uploader:function(){return k.default},VoteManager:function(){return x.default},error:function(){return T},notice:function(){return C}});var n=a(3923),i=a(5903),o=a(2666),r=a(2707),s=a(5506),l=a(6501),c=a(8555),d=a(3263),u=a(3136),p=a(8764),f=a(5597),g=a(3107),h=a(8941),v=a(4821),m=a(8505),_=a(3236),w=a(5771),b=a(5327),y=a(2363),k=a(9832),x=a(238);function j(t){t.keys().forEach(t)}function T(t){$(window).trigger("danbooru:error",t)}function C(t){$(window).trigger("danbooru:notice",t)}a(1545),j(a(4386)),a(2993),a(9366),a(2466),a(7285),a(1707),a(7438),a(455),a(8309),a(471),a(5498),a(3004),a(620),a(5397),j(a(5052))},3923:function(t,e,a){"use strict";a.r(e);var n=a(8505),i=a(9633),o={};o.update=function(t,e){i.SendQueue.add((function(){$.ajax({type:"PUT",url:"/artists/"+t+".json",data:e,success:function(t){n.default.notice("Artist updated.")},error:function(e){n.default.error('There was an error updating <a href="/artists/'.concat(t,'">artist #').concat(t,"</a>"))}})}))},e.default=o,$((function(){$("#c-artists").length&&$("#undelete-artist-link").on("click",(function(t){confirm("Are you sure you want to undelete this artist?")&&o.update($(t.target).data("aid"),{"artist[is_active]":!0}),t.preventDefault()}))}))},2666:function(t,e,a){"use strict";a.r(e);var n=a(8505),i=a(5669);function o(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(!t)return;if("string"===typeof t)return r(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return r(t,e)}(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==a.return||a.return()}finally{if(l)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var s={post_count:0,entries:[],entryGet:function(t){return $.grep(s.entries,(function(e,a){return e.tags===t}))[0]},entriesAllSet:function(t){i.default.put("dab",t?"0":"1");var e,a=o(s.entries);try{for(a.s();!(e=a.n()).done;){e.value.disabled=!t}}catch(n){a.e(n)}finally{a.f()}},lineToggle:function(t){var e=s.entryGet(t);e&&(e.disabled=!e.disabled)},lineSet:function(t,e){var a=s.entryGet(t);a&&(a.disabled=!e)},entryParse:function(t){var e,a=function(t){switch(t){case"=>":return">=";case"=<":return"<=";case"=":case"":return"==";default:return t}},n={tags:t,require:[],exclude:[],optional:[],disabled:!1,hits:0,score_comparison:null,username:!1,user_id:0},i=o(t.match(/\S+/g)||[]);try{for(i.s();!(e=i.n()).done;){var r=e.value;if("-"===r.charAt(0))n.exclude.push(r.slice(1));else if("~"===r.charAt(0))n.optional.push(r.slice(1));else if(r.match(/^score:[<=>]{0,2}-?\d+/)){var s=r.match(/^score:([<=>]{0,2})(-?\d+)/);n.score_comparison=[a(s[1]),parseInt(s[2],10)]}else n.require.push(r)}}catch(d){i.e(d)}finally{i.f()}var l=t.match(/user:([\w\d]+)/)||[];2===l.length&&(n.username=l[1]);var c=t.match(/userid:(\d+)/)||[];return 2===c.length&&(n.user_id=parseInt(c[1],10)),n},entriesParse:function(){s.entries=[];var t,e=JSON.parse(n.default.meta("blacklisted-tags")||"[]"),a=o(e=(e=e.map((function(t){return t.replace(/(rating:[qes])\w+/gi,"$1").toLowerCase()}))).filter((function(t){return""!==t.trim()})));try{for(a.s();!(t=a.n()).done;){var i=t.value,r=s.entryParse(i);s.entries.push(r)}}catch(l){a.e(l)}finally{a.f()}},domEntryToggle:function(t){t.preventDefault();var e=$(t.target).text();s.lineToggle(e),s.apply()},postSaveReplaceSrcPicture:function(t,e){var a=e.children("source"),n=e.children("img");n&&a&&2===a.length&&(n.attr("data-crop-url")||n.attr("data-crop-url",$(a[0]).attr("srcset")),n.attr("data-orig-url")||n.attr("data-orig-url",$(a[1]).attr("srcset")),t.hasClass("post-thumbnail-blacklisted")&&(t.removeClass("blacklisted-active"),n.attr("src","/images/blacklisted-preview.png"),$(a[0]).attr("srcset","/images/blacklisted-preview.png"),$(a[1]).attr("srcset","/images/blacklisted-preview.png")))},postRestoreSrcPicture:function(t,e){var a=e.children("source"),n=e.children("img");if(n&&a&&2===a.length){var i=n.attr("data-crop-url"),o=n.attr("data-orig-url");i&&o&&($(a[0]).attr("srcset",n.attr("data-crop-url")),$(a[1]).attr("srcset",n.attr("data-orig-url")),n.attr("src",n.attr("data-orig-url")))}},postSaveReplaceSrc:function(t){var e=t.find("picture");if(e.length)s.postSaveReplaceSrcPicture(t,e);else{var a=t.children("img")[0];if(a){var n=$(a);n.attr("data-orig-url")||n.attr("data-orig-url",n.attr("src")),("image-container"===t.attr("id")||t.hasClass("post-thumbnail")||t.hasClass("post-thumbnail-blacklisted"))&&(n.attr("src","/images/blacklisted-preview.png"),t.removeClass("blacklisted-active").addClass("blacklisted-active-visible"))}}},postRestoreSrc:function(t){var e=t.find("picture");if(e.length)s.postRestoreSrcPicture(t,e);else{var a=t.children("img")[0];if(a){var n=$(a);n.attr("data-orig-url")&&(n.attr("src",n.attr("data-orig-url")),n.attr("data-orig-url",null))}}},postHide:function(t){var e=$(t);e.addClass("blacklisted").addClass("blacklisted-active"),s.postSaveReplaceSrc(e);var a=e.find("video").get(0);a&&(a.pause(),a.currentTime=0)},postShow:function(t){var e=$(t);s.postRestoreSrc(t),e.addClass("blacklisted").removeClass("blacklisted-active").removeClass("blacklisted-active-visible")},sidebarUpdate:function(){if("1"===i.default.get("dab")?($("#disable-all-blacklists").hide(),$("#re-enable-all-blacklists").show()):($("#disable-all-blacklists").show(),$("#re-enable-all-blacklists").hide()),$("#blacklist-list").html(""),s.post_count<=0)$("#blacklist-box").hide();else{var t,e=o(this.entries);try{for(e.s();!(t=e.n()).done;){var a=t.value;if(0!==a.hits){var n=$("<li/>"),r=$("<a/>"),l=$("<span/>");r.text(a.tags),r.addClass("blacklist-toggle-link"),a.disabled&&r.addClass("blacklisted-active"),r.attr("href","/posts?tags=".concat(encodeURIComponent(a.tags))),r.attr("title",a.tags),r.attr("rel","nofollow"),r.on("click.danbooru",s.domEntryToggle),l.html(a.hits),l.addClass("post-count"),n.append(r),n.append(" "),n.append(l),$("#blacklist-list").append(n)}}}catch(c){e.e(c)}finally{e.f()}$("#blacklisted-count").text("(".concat(s.post_count,")")),$("#blacklist-box").show()}},initialize_disable_all_blacklists:function(){"1"===i.default.get("dab")&&s.entriesAllSet(!1),$("#disable-all-blacklists").on("click.danbooru",(function(t){t.preventDefault(),s.entriesAllSet(!1),s.apply()})),$("#re-enable-all-blacklists").on("click.danbooru",(function(t){t.preventDefault(),s.entriesAllSet(!0),s.apply()}))},apply:function(){s.post_count=0;var t,e=o(this.entries);try{for(e.s();!(t=e.n()).done;){t.value.hits=0}}catch(w){e.e(w)}finally{e.f()}var a,i=o(this.posts());try{for(i.s();!(a=i.n()).done;){var r,l=a.value,c=0,d=o(s.entries);try{for(d.s();!(r=d.n()).done;){var u=r.value;s.postMatch(l,u)&&(u.hits+=1,u.disabled||(c+=1),s.post_count+=1)}}catch(w){d.e(w)}finally{d.f()}var p=$(l);c>0?s.postHide(p):s.postShow(p)}}catch(w){i.e(w)}finally{i.f()}if("true"===n.default.meta("blacklist-users")){var f,g=o(this.entries.filter((function(t){return!1!==t.username})));try{for(g.s();!(f=g.n()).done;){var h=f.value;$('article[data-creator="'.concat(h.username,'"]')).hide()}}catch(w){g.e(w)}finally{g.f()}var v,m=o(this.entries.filter((function(t){return 0!==t.user_id})));try{for(m.s();!(v=m.n()).done;){var _=v.value;$('article[data-creator-id="'.concat(_.user_id,'"]')).hide()}}catch(w){m.e(w)}finally{m.f()}}s.sidebarUpdate()},posts:function(){return $(".post-preview, #image-container, #c-comments .post, .mod-queue-preview.post-preview, .post-thumbnail")},postMatch:function(t,e){var a=$(t);if(a.hasClass("post-no-blacklist"))return!1;var n={id:a.data("id"),score:parseInt(a.data("score"),10),tags:a.data("tags"),rating:a.data("rating"),uploader_id:a.data("uploader-id"),user:a.data("uploader").toString().toLowerCase(),flags:a.data("flags"),is_fav:a.data("is-favorited")};return s.postMatchObject(n,e)},postMatchObject:function(t,e){var a=function(t,e){if(!Array.isArray(t)||"undefined"===typeof e||2!==t.length)return!0;switch(t[0]){case"<":return e<t[1];case"<=":return e<=t[1];case"==":return e==t[1];case">=":return e>=t[1];case">":return e>t[1];default:return!0}}(e.score_comparison,t.score),i=t.tags.match(/\S+/g)||[];return i.push("id:".concat(t.id)),i.push("rating:".concat(t.rating)),i.push("userid:".concat(t.uploader_id)),i.push("user:".concat(t.user)),i.push("height:".concat(t.height)),i.push("width:".concat(t.width)),t.is_fav&&i.push("fav:me"),$.each(t.flags.match(/\S+/g)||[],(function(t,e){i.push("status:".concat(e))})),n.default.is_subset(i,e.require)&&a&&(!e.optional.length||n.default.intersect(i,e.optional).length)&&!n.default.intersect(i,e.exclude).length},initialize_all:function(){s.entriesParse(),s.initialize_disable_all_blacklists(),s.apply(),$("#blacklisted-hider").remove()},initialize_anonymous_blacklist:function(){if(!0===$(document.body).data("user-is-anonymous")){var t=i.default.get("anonymous-blacklist");t&&$("meta[name=blacklisted-tags]").attr("content",t)}},initialize_blacklist_editor:function(){$("#blacklist-edit-dialog").dialog({autoOpen:!1}),$("#blacklist-cancel").on("click",(function(){$("#blacklist-edit-dialog").dialog("close")})),$("#blacklist-save").on("click",(function(){var t=$("#blacklist-edit").val(),e=JSON.stringify(t.split(/\n\r?/));!0===$(document.body).data("user-is-anonymous")?i.default.put("anonymous-blacklist",e):$.ajax("/users/"+n.default.meta("current-user-id")+".json",{method:"PUT",data:{"user[blacklisted_tags]":t}}).done((function(){n.default.notice("Blacklist updated")})).fail((function(t,e,a){n.default.error("Failed to update blacklist")})),$("#blacklist-edit-dialog").dialog("close"),$("meta[name=blacklisted-tags]").attr("content",e),s.initialize_all()})),$("#blacklist-edit-link").on("click",(function(t){t.preventDefault();var e=JSON.parse(n.default.meta("blacklisted-tags")||"[]");e=(e=e.map((function(t){return t.replace(/(rating:[qes])\w+/gi,"$1").toLowerCase()}))).filter((function(t){return""!==t.trim()})),$("#blacklist-edit").val(e.join("\n")),$("#blacklist-edit-dialog").dialog("open")}))},collapseGet:function(){return"1"===(i.default.get("bc")||"1")},collapseSet:function(t){i.default.put("bc",t?"1":"0")},collapseUpdate:function(){s.collapseGet()?($("#blacklist-list").hide(),$("#blacklist-collapse").addClass("hidden")):($("#blacklist-list").show(),$("#blacklist-collapse").removeClass("hidden"))},initialize_collapse:function(){$("#blacklist-collapse").on("click",(function(t){t.preventDefault();var e=s.collapseGet();s.collapseSet(!e),s.collapseUpdate()})),s.collapseUpdate()}};$(document).ready((function(){s.initialize_collapse(),s.initialize_anonymous_blacklist(),s.initialize_blacklist_editor(),s.initialize_all()})),e.default=s},2707:function(t,e,a){"use strict";a.r(e);var n=a(8505),i={atme:function(t){$.ajax({url:"/blips/".concat(t,".json"),type:"GET",dataType:"json",accept:"text/javascript",data:{id:t}}).done((function(t){$("#blip_body_for_")[0].value+="@"+t.creator_name.replace(/ /g,"_")+": ",$("#blip_body_for_")[0].focus(),$("#blip_response_to")[0].value=t.id})).fail((function(t){n.default.error(t.responseText)}))},quote:function(t){$.ajax({url:"/blips/".concat(t,".json"),type:"GET",dataType:"json",accept:"text/javascript",data:{id:t}}).done((function(t){var e=t.body.replace(/\[quote\](?:.|\n|\r)+?\[\/quote\][\n\r]*/gm,"");$("#blip_body_for_")[0].value+='[quote]"'.concat(t.creator_name,'":/user/show/').concat(t.creator_id," said:\n").concat(e,"\n[/quote]\n\n"),$("#blip_body_for_")[0].focus(),$("#blip_response_to")[0].value=t.id})).fail((function(t){n.default.error(t.responseText)}))}};$((function(){$("#c-blips").length&&($(".blip-atme-link").on("click",(function(t){i.atme($(t.target).data("bid")),t.preventDefault()})),$(".blip-reply-link").on("click",(function(t){i.quote($(t.target).data("bid")),t.preventDefault()})))})),e.default=i},5506:function(t,e,a){"use strict";a.r(e);var n=a(8505),i={initialize_all:function(){($("#c-posts").length||$("#c-comments").length)&&($(".edit_comment_link").on("click",i.show_edit_form),$(".expand-comment-response").on("click",i.show_new_comment_form),$(".comment-vote-up-link").on("click",i.vote_up),$(".comment-vote-down-link").on("click",i.vote_down),$(".comment-reply-link").on("click",i.quote),$(".comment-hide-link").on("click",i.hide),$(".comment-unhide-link").on("click",i.unhide),$(".comment-delete-link").on("click",i.delete),$(".show-all-comments-for-post-link").on("click",i.show_all),$(".comment-tag-hide-link").on("click",i.toggle_post_tags))},reinitialize_all:function(){($("#c-posts").length||$("#c-comments").length)&&($(".comment-reply-link").off("click"),$(".comment-hide-link").off("click"),$(".comment-unhide-link").off("click"),$(".comment-delete-link").off("click"),$(".show-all-comments-for-post-link").off("click"),$(".comment-tag-hide-link").off("click"),$(".edit_comment_link").off("click"),$(".expand-comment-response").off("click"),$(".comment-vote-up-link").off("click"),$(".comment-vote-down-link").off("click"),i.initialize_all())},show_all:function(t){t.preventDefault();var e=$(t.target).data("pid");$.ajax({url:"/posts/".concat(e,"/comments.json"),type:"GET",dataType:"json"}).done((function(t){$("#threshold-comments-notice-for-".concat(e)).hide(),$("div.comments-for-post[data-post-id=".concat(e,"] div.list-of-comments")).html(t.html),i.reinitialize_all(),$(window).trigger("e621:add_deferred_posts",t.posts)})).fail((function(t){n.default.error("Failed to fetch all comments for this post.")}))},hide:function(t){if(t.preventDefault(),confirm("Are you sure you want to hide this comment?")){var e=$(t.target).parents("article.comment").data("comment-id");$.ajax({url:"/comments/".concat(e,"/hide.json"),type:"POST",dataType:"json"}).done((function(t){$('.comment[data-comment-id="'.concat(e,'"] div.author h1')).append(" (hidden)"),$('.comment[data-comment-id="'.concat(e,'"]')).attr("data-is-deleted","true")})).fail((function(t){n.default.error("Failed to hide comment.")}))}},unhide:function(t){if(t.preventDefault(),confirm("Are you sure you want to unhide this comment?")){var e=$(t.target).parents("article.comment").data("comment-id");$.ajax({url:"/comments/".concat(e,"/unhide.json"),type:"POST",dataType:"json"}).done((function(t){var a=$('.comment[data-comment-id="'.concat(e,'"] div.author h1'));a.text(a.text().replace(" (hidden)","")),$('.comment[data-comment-id="'.concat(e,'"]')).attr("data-is-deleted","false")})).fail((function(t){n.default.error("Failed to unhide comment.")}))}},delete:function(t){if(t.preventDefault(),confirm("Are you sure you want to permanently delete this comment?")){var e=$(t.target).parents("article.comment"),a=e.data("comment-id");$.ajax({url:"/comments/".concat(a,".json"),type:"DELETE",dataType:"json"}).done((function(t){e.remove()})).fail((function(t){n.default.error("Failed to delete comment.")}))}},quote:function(t){t.preventDefault();var e=$(t.target).parents("article.comment"),a=e.data("post-id"),i=e.data("comment-id");$.ajax({url:"/comments/".concat(i,".json"),type:"GET",dataType:"json",accept:"text/javascript"}).done((function(t){var n=t.body.replace(/\[quote\](?:.|\n|\r)+?\[\/quote\][\n\r]*/gm,"");n='[quote]"'.concat(e.data("creator"),'":/user/show/').concat(e.data("creator-id")," said:\n").concat(n,"\n[/quote]\n\n");var i=$('div.comments-for-post[data-post-id="'.concat(a,'"] div.new-comment'));i.find(".expand-comment-response").click();var o=i.find("textarea"),r=n;o.val().length>0&&(r=o.val()+"\n\n"+r),o.val(r),o.selectEnd()})).fail((function(t){n.default.error(t.responseText)}))},toggle_post_tags:function(t){t.preventDefault();var e=$(t.target);$("#post-tags-".concat(e.data("post-id"))).toggleClass("hidden")},show_new_comment_form:function(t){t.preventDefault(),$(t.target).hide();var e=$(t.target).closest("div.new-comment").find("form");e.show(),e[0].scrollIntoView(!1)},show_edit_form:function(t){t.preventDefault(),$(this).closest(".comment").find(".edit_comment").show()},vote_up:function(t){var e=$(t.target).attr("data-id");i.vote(e,1)},vote_down:function(t){var e=$(t.target).attr("data-id");i.vote(e,-1)},vote:function(t,e){$.ajax({method:"POST",url:"/comments/".concat(t,"/votes.json"),data:{score:e},dataType:"json"}).done((function(e){var a,i="score-neutral score-positive score-negative",o=t,r=e.score,s=e.our_score;$("#comment-score-"+o).removeClass(i),$("#comment-vote-up-"+o).removeClass(i),$("#comment-vote-down-"+o).removeClass(i),$("#comment-score-"+o).text(r),$("#comment-score-"+o).addClass(0===(a=r)?"score-neutral":a>0?"score-positive":"score-negative"),$("#comment-vote-up-"+o).addClass(s>0?"score-positive":"score-neutral"),$("#comment-vote-down-"+o).addClass(s<0?"score-negative":"score-neutral"),n.default.notice("Vote saved")})).fail((function(t){n.default.error(t.responseJSON.message)}))}};$(document).ready((function(){i.initialize_all()})),e.default=i},2389:function(t,e,a){"use strict";a.r(e);var n=a(8437),i=a(5669),o=a(8505);$((function(){$("#theme-switcher").change((function(t){var e=$(this).val();i.default.put("theme",e),$("body").attr("data-th-main",e)}));var t,e,a,r=i.default.get("theme")||"hexagon";$("body").attr("data-th-main",r),$("#theme-switcher").val(r),$("#hide-dmail-notice").on("click.danbooru",(function(t){var e=$("#dmail-notice");e.hide();var a=e.data("id");n.default.put("hide_dmail_notice",a),t.preventDefault()})),$("#close-notice-link").on("click.danbooru",(function(t){$("#notice").fadeOut("fast"),t.preventDefault()})),$("#desktop-version-link a").on("click.danbooru",(function(t){t.preventDefault(),$.ajax("/users/"+o.default.meta("current-user-id")+".json",{method:"PUT",data:{"user[disable_responsive_mode]":"true"}}).then((function(){location.reload()}))})),$(".revert-item-link").on("click",(function(t){t.preventDefault();var e=$(t.target),a=e.data("noun");if(confirm("Are you sure you want to revert ".concat(a," to this version?"))){var n=e.attr("href");$.ajax({method:"PUT",url:n,dataType:"json"}).done((function(t){location.reload()})).fail((function(t){o.default.error("Failed to revert to specified version.")}))}})),t=$("#searchform"),e=$("#search-form-show-link"),a=$("#search-form-hide-link"),t.length&&(e.on("click",(function(n){n.preventDefault(),t.fadeIn("fast"),e.hide(),a.show()})),a.on("click",(function(n){n.preventDefault(),t.fadeOut("fast"),e.show(),a.hide()})))})),window.submitInvisibleRecaptchaForm=function(){document.getElementById("signup-form").submit()}},8437:function(t,e,a){"use strict";a.r(e);var n=a(8505),i={put:function(t,e,a){var i="";if("session"!==a){a||(a=365);var o=new Date;o.setTime(o.getTime()+24*a*60*60*1e3),i="expires="+o.toGMTString()+"; "}var r=t+"="+encodeURIComponent(e)+"; "+i+"path=/; SameSite=Lax";return document.cookie.length<4090-r.length?(document.cookie=r,!0):(n.default.error("You have too many cookies on this site. Consider deleting them all."),!1)},raw_get:function(t){for(var e=t+"=",a=document.cookie.split(";"),n=0;n<a.length;++n){for(var i=a[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(e))return i.substring(e.length,i.length)}return""},get:function(t){return this.unescape(this.raw_get(t))},remove:function(t){this.put(t,"",-1)},unescape:function(t){return decodeURIComponent(t.replace(/\+/g," "))}};e.default=i},6501:function(t,e,a){"use strict";a.r(e);var n=a(9633);function i(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(!t)return;if("string"===typeof t)return o(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return o(t,e)}(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){l=!0,r=t},f:function(){try{s||null==a.return||a.return()}finally{if(l)throw r}}}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var r={};r.buttons=[{icon:"f032",title:"Bold",content:"[b]%selection%[/b]"},{icon:"f033",title:"Italics",content:"[i]%selection%[/i]"},{icon:"f0cc",title:"Strikethrough",content:"[s]%selection%[/s]"},{icon:"f0cd",title:"Underline",content:"[u]%selection%[/u]"},null,{icon:"f1dc",title:"Header",content:"h2.%selection%"},{icon:"f070",title:"Spoiler",content:"[spoiler]%selection%[/spoiler]"},{icon:"f121",title:"Code",content:"[code]%selection%[/code]"},{icon:"f10e",title:"Quote",content:"[quote]%selection%[/quote]"}],r.create_wrapper=function(t){var e=$("<div>").addClass("dtext-formatter").attr({"data-editing":"true"}).insertBefore(t);!function(t){$("<div>").addClass("dtext-formatter-tabs").html('<a data-action="edit" role="tab">Write</a><a data-action="show" role="tab">Preview</a>').on("click","a",(function(e){e.preventDefault(),t.trigger("e621:toggle")})).appendTo(t)}(e),function(t,e){var a=$("<div>").addClass("dtext-formatter-buttons").attr({role:"toolbar"}).appendTo(t);t.on("e621:reload",(function(){a.html("");var t,n=i(r.buttons);try{var o=function(){var n=t.value;if(null==n)return $("<span>").appendTo(a),"continue";$("<a>").html("&#x"+n.icon).attr({title:n.title,role:"button"}).on("click",(function(t){t.preventDefault(),r.process_formatting(n.content,e)})).appendTo(a)};for(n.s();!(t=n.n()).done;)o()}catch(s){n.e(s)}finally{n.f()}})),t.trigger("e621:reload")}(e,t),t.addClass("dtext-formatter-input").appendTo(e),function(t,e){var a=$("<div>").addClass("dtext-formatter-preview dtext-container").appendTo(t);t.on("e621:toggle",(function(){"true"==t.attr("data-editing")?(a.css("min-height",e.outerHeight()),t.attr("data-editing","false"),function(t,e){var a=t.val().trim();if(!a)return e.text(""),void t.removeData("cache");if(t.data("cache")==a)return;t.data("cache",a),e.html("").attr("loading","true"),n.SendQueue.add((function(){$.ajax({type:"post",url:"/dtext_preview",dataType:"json",data:{body:a},success:function(n){"true"===e.attr("loading")&&t.data("cache")===a&&(e.attr("loading","false").html(n.html),$(window).trigger("e621:add_deferred_posts",n.posts))},error:function(){e.attr("loading","false").text("Unable to fetch DText preview."),t.removeData("cache")}})}))}(e,a)):(t.attr("data-editing","true"),a.attr("loading","false"))}))}(e,t),function(t,e){var a=e.attr("data-limit")||0,n=$("<div>").addClass("dtext-formatter-charcount").attr({"data-limit":a,"data-count":(e.val()+"").length}).appendTo(t);e.on("input.danbooru.formatter",(function(){var t=(e.val()+"").length;n.toggleClass("overfill",t>=a).attr("data-count",t)}))}(e,t)},r.destroy_wrapper=function(t){var e=t.parents(".dtext-formatter");e.length&&(t.insertAfter(e).removeClass("dtext-formatter-input").off("input.danbooru.formatter"),e.remove())},r.process_formatting=function(t,e){var a=e.val()+"",n={start:e.prop("selectionStart"),end:e.prop("selectionEnd")},i=t.indexOf("%selection%"),o=t.length-(t.indexOf("%selection%")+11);t=t.replace(/%selection%/g,a.substring(n.start,n.end)),e.trigger("focus"),document.execCommand("insertText",!1,t)||e.val(a.substring(0,n.start)+t+a.substring(n.end,a.length)),e.prop("selectionStart",n.start+i),e.prop("selectionEnd",n.start+t.length-o),e.trigger("focus")},r.initialize_all_inputs=function(){$("textarea.dtext-previewable").each((function(t,e){r.create_wrapper($(e))}))},r.initialize_dynamic_elements=function(){$(document).on("click.danbooru",".expandable-header",(function(t){var e=$(this);e.next().fadeToggle("fast"),e.parent().toggleClass("expanded")}))},$((function(){r.initialize_all_inputs(),r.initialize_dynamic_elements()})),e.default=r},8565:function(t,e,a){"use strict";a.r(e);var n=a(3263),i=a(8505),o=a(9633),r={initialize_actions:function(){$("#add-to-favorites, #add-fav-button").on("click",(function(t){t.preventDefault(),r.create($(t.target).data("pid"))})),$("#remove-from-favorites, #remove-fav-button").on("click",(function(t){t.preventDefault(),r.destroy($(t.target).data("pid"))}))},after_action:function(t,e){$("#add-to-favorites, #add-fav-button, #remove-from-favorites, #remove-fav-button").toggle(),$("#remove-fav-button").addClass("animate"),setTimeout((function(){$("#remove-fav-button").removeClass("animate")}),3e3);var a=$("#favcount-for-post-".concat(t)),n=parseInt(a.text(),10);a.text(n+e),$(".fav-buttons").toggleClass("fav-buttons-false").toggleClass("fav-buttons-true")},create:function(t){n.default.notice_update("inc"),o.SendQueue.add((function(){$.ajax({type:"POST",url:"/favorites.json",data:{post_id:t},dataType:"json"}).done((function(){n.default.notice_update("dec"),r.after_action(t,1),i.default.notice("Favorite added")})).fail((function(t,e,a){i.default.error("Error: "+t.responseJSON.message)}))}))},destroy:function(t){n.default.notice_update("inc"),o.SendQueue.add((function(){$.ajax({type:"DELETE",url:"/favorites/"+t+".json",dataType:"json"}).done((function(){n.default.notice_update("dec"),r.after_action(t,-1),i.default.notice("Favorite removed")})).fail((function(t,e,a){i.default.error("Error: "+t.responseJSON.message)}))}))}};$(r.initialize_actions),e.default=r},1462:function(t,e,a){"use strict";a.r(e);var n=a(8505),i={initialize_all:function(){$("#c-forum-topics #a-show,#c-forum-posts #a-show").length&&(this.initialize_edit_links(),$(".forum-post-reply-link").on("click",i.quote),$(".forum-post-hide-link").on("click",i.hide),$(".forum-post-unhide-link").on("click",i.unhide),$(".forum-vote-up").on("click",(function(t){return i.vote(t,1)})),$(".forum-vote-meh").on("click",(function(t){return i.vote(t,0)})),$(".forum-vote-down").on("click",(function(t){return i.vote(t,-1)})),$(document).on("click",".forum-vote-remove",i.vote_remove))}};i.vote=function(t,e){t.preventDefault();var a=$(t.target.parentNode).data("forum-id");$.ajax({url:"/forum_posts/".concat(a,"/votes.json"),type:"POST",dataType:"json",accept:"text/javascript",data:{"forum_post_vote[score]":e}}).done((function(t){var e,a,n,i;e=t,a=$("<a>").attr("href","#").attr("data-forum-id",e.forum_post_id).addClass("forum-vote-remove").append($("<i>").addClass("far").addClass({1:"fa-thumbs-up",0:"fa-meh","-1":"fa-thumbs-down"}[e.score.toString()])),n=$("<a>").attr("href","/users/".concat(e.creator_id)).text(e.creator_name),(i=$("<li>").addClass("vote-score-".concat({1:"up",0:"meh","-1":"down"}[e.score])).addClass("own-forum-vote")).append(a).append(" ").append(n),$("#forum-post-votes-for-".concat(e.forum_post_id)).prepend(i),$(".forum-post-vote-block").remove()})).fail((function(t){n.default.error("Failed to vote on forum post.")}))},i.vote_remove=function(t){t.preventDefault();var e=$(t.target.parentNode).data("forum-id");$.ajax({url:"/forum_posts/".concat(e,"/votes.json"),type:"DELETE",dataType:"json",accept:"text/javascript"}).done((function(e){$(t.target).parents(".own-forum-vote").remove(),n.default.notice("Vote removed.")})).fail((function(t){n.default.error("Failed to unvote on forum post.")}))},i.quote=function(t){t.preventDefault();var e=$(t.target).parents("article.forum-post"),a=e.data("forum-post-id");$.ajax({url:"/forum_posts/".concat(a,".json"),type:"GET",dataType:"json",accept:"text/javascript"}).done((function(t){var a=t.body.replace(/\[quote\](?:.|\n|\r)+?\[\/quote\][\n\r]*/gm,"");a='[quote]"'.concat(e.data("creator"),'":/user/show/').concat(e.data("creator-id")," said:\n").concat(a,"\n[/quote]\n\n");var n=$("#forum_post_body"),i=a;n.val().length>0&&(i=n.val()+"\n\n"+i),n.val(i),n.selectEnd(),$("#topic-response").show(),setTimeout((function(){$("#topic-response")[0].scrollIntoView()}),15)})).fail((function(t){n.default.error(t.responseText)}))},i.hide=function(t){if(t.preventDefault(),confirm("Are you sure you want to hide this post?")){var e=$(t.target).parents("article.forum-post").data("forum-post-id");$.ajax({url:"/forum_posts/".concat(e,"/hide.json"),type:"POST",dataType:"json"}).done((function(t){$('.forum-post[data-forum-post-id="'.concat(e,'"] div.author h4')).append(" (hidden)"),$('.forum-post[data-forum-post-id="'.concat(e,'"]')).attr("data-is-deleted","true")})).fail((function(t){n.default.error("Failed to hide post.")}))}},i.unhide=function(t){if(t.preventDefault(),confirm("Are you sure you want to unhide this post?")){var e=$(t.target).parents("article.forum-post").data("forum-post-id");$.ajax({url:"/forum_posts/".concat(e,"/unhide.json"),type:"POST",dataType:"json"}).done((function(t){var a=$('.forum-post[data-forum-post-id="'.concat(e,'"] div.author h4'));a.text(a.text().replace(" (hidden)","")),$('.forum-post[data-forum-post-id="'.concat(e,'"]')).attr("data-is-deleted","false")})).fail((function(t){n.default.error("Failed to unhide post.")}))}},i.initialize_edit_links=function(){$(".edit_forum_post_link").on("click.danbooru",(function(t){var e=$(this).attr("id").match(/^edit_forum_post_link_(\d+)$/)[1];$("#edit_forum_post_"+e).fadeToggle("fast"),t.preventDefault()})),$(".edit_forum_topic_link").on("click.danbooru",(function(t){var e=$(this).attr("id").match(/^edit_forum_topic_link_(\d+)$/)[1];$("#edit_forum_topic_"+e).fadeToggle("fast"),t.preventDefault()}))},$(document).ready((function(){i.initialize_all()})),e.default=i},2252:function(t,e,a){"use strict";a.r(e);var n=a(8437),i={init:function(){var t=$(".guest-warning");"seen"===n.default.get("gw")||$("#a-terms-of-service").length>0||(t.show(),$("#guest-warning-accept").on("click",(function(){n.default.put("gw","seen"),t.hide()})),$("#guest-warning-decline").on("click",(function(){n.default.put("gw","reject"),window.location.assign("https://www.google.com/")})))}};$(document).ready((function(){i.init()})),e.default=i},253:function(t,e,a){"use strict";a.r(e);var n={initialize_all:function(){$("#c-janitor-trials").length&&$("input[value=Test]").on("click.danbooru",(function(t){$.ajax({type:"get",url:"/janitor_trials/test.json",data:{janitor_trial:{user_name:$("#janitor_trial_user_name").val()}},success:function(t){$("#test-results").html(t)}}),t.preventDefault()}))}};$(document).ready((function(){n.initialize_all()})),e.default=n},5669:function(t,e,a){"use strict";a.r(e);var n={put:function(t,e){localStorage[t]=e},get:function(t){return localStorage[t]}};e.default=n},6195:function(t,e,a){"use strict";a.r(e);var n=a(5669),i={current:0};function o(t){var e=window.mascots,a=e[t][0].substr(0,e[t][0].lastIndexOf("."))+"_blur"+e[t][0].slice(e[t][0].lastIndexOf("."));$("body").css("background-image","url("+e[t][0]+")"),$("body").css("background-color",e[t][1]),$(".mascotbox").css("background-image","url("+a+")"),$(".mascotbox").css("background-color",e[t][1]),e[t][2]?$("#mascot_artist").html("Mascot by "+e[t][2]):$("#mascot_artist").html("&nbsp;")}function r(){var t=window.mascots;i.current+=1,i.current=i.current%t.length,o(i.current),n.default.put("mascot",i.current)}$((function(){$("#c-static > #a-home").length&&function(){$("#change-mascot").on("click",r);var t=window.mascots;i.current=parseInt(n.default.get("mascot")),(isNaN(i.current)||i.current<0||i.current>=t.length)&&(i.current=Math.floor(Math.random()*t.length)),o(i.current)}()}))},640:function(t,e,a){"use strict";a.r(e);var n=a(8505),i=a(3263),o={processed:0,increment_processed:function(){"1"===n.default.meta("random-mode")&&(o.processed+=1,12===o.processed&&(window.location=n.default.meta("return-to")))},detailed_rejection_dialog:function(){return $("#post_disapproval_post_id").val($(this).data("post-id")),$("#detailed-rejection-dialog").find("form")[0].reset(),n.default.dialog("Detailed Rejection","#detailed-rejection-dialog"),!1}};$((function(){$(window).on("danbooru:modqueue_increment_processed",o.increment_processed),$(document).on("click.danbooru",".quick-mod .detailed-rejection-link",o.detailed_rejection_dialog),$(".delete-with-reason-link").on("click",(function(t){t.preventDefault();var e=$(t.target).attr("data-post-id"),a=$(t.target).data("prompt"),n=$(t.target).data("reason");confirm("Delete post for ".concat(a,"?"))&&i.default.delete_with_reason(e,n,!0)}))})),e.default=o},5468:function(t,e,a){"use strict";a.r(e);var n=a(5669),i={initialize:function(){if($("#news").length){var t=parseInt($("#news").data("id"),10);$("#news").on("click",(function(){$("#news").toggleClass("open")})),$("#news-closebutton").on("click",(function(){$("#news").hide(),n.default.put("hide_news_notice",t.toString())})),parseInt(n.default.get("hide_news_notice")||0,10)<t&&$("#news").show()}}};$((function(){i.initialize()})),e.default=i},8555:function(t,e,a){"use strict";a.r(e);var n=a(8505),i={Box:{create:function(t){var e=$("<div/>");e.addClass("note-box-inner-border");var a=0;a=i.embed?.95:.5,e.css({opacity:a});var n=$("<div/>");return n.addClass("note-box"),i.embed&&n.addClass("embedded"),n.data("id",String(t)),n.attr("data-id",String(t)),n.draggable({containment:$("#image"),stop:function(t,e){i.Box.update_data_attributes(n)}}),n.resizable({containment:$("#image"),handles:"se, nw",stop:function(t,e){i.Box.update_data_attributes(n)}}),n.css({position:"absolute"}),n.append(e),i.Box.bind_events(n),n},update_data_attributes:function(t){var e=$("#image"),a=$("#image-container"),n=e.width()/parseFloat(a.data("width")),i=parseFloat(t.css("left")),o=parseFloat(t.css("top")),r=parseFloat(t.css("width")),s=parseFloat(t.css("height"));i=parseInt(i/n),o=parseInt(o/n),r=parseInt(r/n),s=parseInt(s/n),t.data("x",i),t.data("y",o),t.data("width",r),t.data("height",s)},bind_events:function(t){t.on("dragstart.danbooru resizestart.danbooru",(function(t){var e=$(t.currentTarget);if(e.find(".note-box-inner-border").addClass("unsaved"),i.dragging=!0,i.clear_timeouts(),i.Body.hide_all(),i.embed){var a=e.find("div.bg");a.length&&a.hide()}t.stopPropagation()})),t.on("resize.danbooru",(function(t){var e=$(t.currentTarget);i.Box.resize_inner_border(e),t.stopPropagation()})),t.on("dragstop.danbooru resizestop.danbooru",(function(t){if(i.dragging=!1,i.embed){var e=$(t.currentTarget),a=e.find("div.bg");a.length&&(a.show(),i.Box.resize_inner_border(e.closest(".note-box")))}t.stopPropagation()})),t.on("mouseover.danbooru mouseout.danbooru",(function(t){if(!i.dragging){var e=$(this),a=$(t.currentTarget);"mouseover"===t.type?(i.Body.show(a.data("id")),i.editing&&(e.resizable("enable"),e.draggable("enable"))):"mouseout"===t.type&&(i.Body.hide(a.data("id")),i.editing&&(e.resizable("disable"),e.draggable("disable"))),t.stopPropagation()}}))},find:function(t){return $("#note-container div.note-box[data-id="+t+"]")},show_highlighted:function(t){var e=t.data("id");i.Body.show(e),$(".note-box-highlighted").removeClass("note-box-highlighted"),t.addClass("note-box-highlighted"),t[0].scrollIntoView(!1)},resize_inner_border:function(t){var e=t.find("div.note-box-inner-border");if(e.css({height:t.height()-2,width:t.width()-2}),e.width()>=t.width()-2&&t.width(e.width()+2),e.height()>=t.height()-2&&t.height(e.height()+2),i.embed){var a=e.find("div.bg");a.length&&(a.height(e.height()),a.width(e.width()))}},scale:function(t){var e=$("#image"),a=$("#image-container"),n=e.width()/parseFloat(a.data("width"));t.css({top:Math.ceil(parseFloat(t.data("y"))*n),left:Math.ceil(parseFloat(t.data("x"))*n),width:Math.max(5,Math.ceil(parseFloat(t.data("width"))*n)),height:Math.max(5,Math.ceil(parseFloat(t.data("height"))*n))}),i.Box.resize_inner_border(t)},scale_all:function(){var t=document.getElementById("note-container");if(null!==t){var e="none"!==t.style.display;e&&(t.style.display="none"),$(".note-box").each((function(t,e){i.Box.scale($(e))})),e&&(t.style.display="block")}},toggle_all:function(){var t=$("#note-container");"hidden"===t.css("visibility")?t.css("visibility","visible"):t.css("visibility","hidden")}},Body:{create:function(t){var e=$("<div></div>");return e.addClass("note-body"),e.data("id",String(t)),e.attr("data-id",String(t)),e.hide(),i.Body.bind_events(e),e},initialize:function(t){var e=i.Box.find(t.data("id"));t.css({top:e.position().top+e.height()+5,left:e.position().left}),i.Body.bound_position(t)},bound_position:function(t){var e=$("#image"),a=e.offset().left+e.width();t.offset().left+t.width()>a&&t.css({left:t.position().left-10-(t.offset().left+t.width()-a)})},show:function(t){i.Body.hide_all(),i.clear_timeouts();var e=i.Body.find(t);e.data("resized")||(i.Body.resize(e),e.data("resized","true")),e.show(),i.Body.initialize(e)},find:function(t){return $("#note-container div.note-body[data-id="+t+"]")},hide:function(t){var e=i.Body.find(t);i.timeouts.push(setTimeout((function(){e.hide()}),350))},hide_all:function(){$("#note-container div.note-body").hide()},resize:function(t){t.css("min-width","");var e=t.width(),a=t.height(),n=1.6180339887,i=0,o=0,r=0,s=0;if(e/a<n){r=140,s=400;do{i=e,o=(r+s)/2,t.css("min-width",o),(e=t.width())/(a=t.height())<n?r=o:s=o}while(r<s&&e>i)}else if(t[0].scrollWidth<=t.width()){r=20,s=e;do{o=(r+s)/2,t.css("min-width",o),t.height()>a?r=o:s=o}while(s-r>4);t.height()>a&&t.css("min-width",s)}},set_text:function(t,e,a){i.Body.display_text(t,a),i.embed&&i.Body.display_text(e.children("div.note-box-inner-border"),a),i.Body.resize(t),i.Body.bound_position(t)},display_text:function(t,e){e=(e=(e=e.replace(/<tn>/g,'<p class="tn">')).replace(/<\/tn>/g,"</p>")).replace(/\n/g,"<br>"),t.html(e)},bind_events:function(t){t.on("mouseover.danbooru",(function(t){var e=$(t.currentTarget);i.Body.show(e.data("id")),t.stopPropagation()})),t.on("mouseout.danbooru",(function(t){var e=$(t.currentTarget);i.Body.hide(e.data("id")),t.stopPropagation()})),"Anonymous"!==n.default.meta("current-user-name")?t.on("click.danbooru",(function(t){if("A"!==t.target.tagName){var e=$(t.currentTarget);i.Edit.show(e)}t.stopPropagation()})):t.on("click.danbooru",(function(t){"A"!==t.target.tagName&&n.default.error("You must be logged in to edit notes"),t.stopPropagation()}))}},Edit:{show:function(t){var e=t.data("id");if(!i.editing){$(".note-box").resizable("disable"),$(".note-box").draggable("disable"),i.embed&&$(".note-box").css("opacity","0.5");var a=$("<textarea></textarea>");a.css({width:"97%",height:"92%",resize:"none"}),"<em>Click to edit</em>"!==t.html()&&a.val(t.data("original-body"));var n=$("<div></div>");n.append(a),n.data("id",e),n.dialog({width:360,height:210,position:{my:"right",at:"right-20",of:window},classes:{"ui-dialog":"note-edit-dialog"},title:"Edit note",buttons:{Save:i.Edit.save,Preview:i.Edit.preview,Cancel:i.Edit.cancel,Delete:i.Edit.destroy,History:i.Edit.history}}),n.data("uiDialog")._title=function(t){t.html(this.options.title)},n.dialog("option","title","Edit note #"+e+' (<a href="/wiki_pages/e621:notes">view help</a>)'),n.on("dialogclose.danbooru",(function(){i.editing=!1,$(".note-box").resizable("enable"),$(".note-box").draggable("enable"),i.embed&&$(".note-box").css("opacity","0.95")})),a.selectEnd(),i.editing=!0}},parameterize_note:function(t,e){var a=$("#image"),i=$("#image-container"),o=parseInt(i.data("width")),r=parseInt(a.width())/o,s={note:{x:t.position().left/r,y:t.position().top/r,width:t.width()/r,height:t.height()/r,body:e.data("original-body")}};return t.data("id").match(/x/)&&(s.note.html_id=t.data("id"),s.note.post_id=n.default.meta("post-id")),s},error_handler:function(t,e,a){n.default.error("Error: "+(t.responseJSON.reason||t.responseJSON.reasons.join("; ")))},success_handler:function(t,e,a){var n=null;if(t.html_id){var o=i.Body.find(t.html_id);n=i.Box.find(t.html_id),o.data("id",String(t.id)).attr("data-id",t.id),n.data("id",String(t.id)).attr("data-id",t.id),n.find(".note-box-inner-border").removeClass("unsaved")}else(n=i.Box.find(t.id)).find(".note-box-inner-border").removeClass("unsaved")},save:function(){var t=$(this),e=t.find("textarea"),a=t.data("id"),n=i.Body.find(a),o=i.Box.find(a),r=e.val();n.data("original-body",r),i.Body.set_text(n,o,"Loading..."),$.get("/note_previews.json",{body:r}).then((function(t){i.Body.set_text(n,o,t.body),i.Box.resize_inner_border(o),n.show()})),t.dialog("close"),a.match(/\d/)?$.ajax("/notes/"+a+".json",{type:"PUT",data:i.Edit.parameterize_note(o,n),error:i.Edit.error_handler,success:i.Edit.success_handler}):$.ajax("/notes.json",{type:"POST",data:i.Edit.parameterize_note(o,n),error:i.Edit.error_handler,success:i.Edit.success_handler})},preview:function(){var t=$(this),e=t.find("textarea"),a=t.data("id"),n=i.Body.find(a),o=e.val(),r=i.Box.find(a);r.find(".note-box-inner-border").addClass("unsaved"),i.Body.set_text(n,r,"Loading..."),$.get("/note_previews.json",{body:o}).then((function(t){i.Body.set_text(n,r,t.body),n.show()}))},cancel:function(){$(this).dialog("close")},destroy:function(){if(confirm("Do you really want to delete this note?")){var t=$(this),e=t.data("id");e.match(/\d/)&&$.ajax("/notes/"+e+".json",{type:"DELETE",success:function(){i.Box.find(e).remove(),i.Body.find(e).remove(),t.dialog("close")}})}},history:function(){var t=$(this).data("id");t.match(/\d/)&&(window.location.href="/note_versions?search[note_id]="+t),$(this).dialog("close")}},TranslationMode:{active:!1,toggle:function(t){i.TranslationMode.active?i.TranslationMode.stop(t):i.TranslationMode.start(t)},start:function(t){t.preventDefault(),""!==n.default.meta("current-user-id")?i.TranslationMode.active||($("#image").css("cursor","crosshair"),i.TranslationMode.active=!0,$(document.body).addClass("mode-translation"),$("#original-file-link").click(),$("#image").off("click",i.Box.toggle_all),$("#image").on("mousedown.danbooru.note",i.TranslationMode.Drag.start),$(document).on("mouseup.danbooru.note",i.TranslationMode.Drag.stop),$("#mark-as-translated-section").show(),n.default.notice('Translation mode is on. Drag on the image to create notes. <a href="#">Turn translation mode off</a> (shortcut is <span class="key">n</span>).'),$("#notice a:contains(Turn translation mode off)").on("click.danbooru",i.TranslationMode.stop)):n.default.error("You must be logged in to edit notes")},stop:function(t){t.preventDefault(),i.TranslationMode.active=!1,$("#image").css("cursor","auto"),$("#image").on("click.danbooru",i.Box.toggle_all),$("#image").off("mousedown",i.TranslationMode.Drag.start),$(document).off("mouseup",i.TranslationMode.Drag.stop),$(document.body).removeClass("mode-translation"),$("#close-notice-link").click(),$("#mark-as-translated-section").hide()},create_note:function(t,e,a,n,o){var r=$("#image").offset();(n>9||o>9)&&(n<=9?n=10:o<=9&&(o=10),i.create(e-r.left,a-r.top,n,o)),$("#note-container").css("visibility","visible"),t.stopPropagation(),t.preventDefault()},Drag:{dragging:!1,dragStartX:0,dragStartY:0,dragDistanceX:0,dragDistanceY:0,x:0,y:0,w:0,h:0,start:function(t){1===t.which&&(t.preventDefault(),$(document).on("mousemove.danbooru",i.TranslationMode.Drag.drag),i.TranslationMode.Drag.dragStartX=t.pageX,i.TranslationMode.Drag.dragStartY=t.pageY)},drag:function(t){i.TranslationMode.Drag.dragDistanceX=t.pageX-i.TranslationMode.Drag.dragStartX,i.TranslationMode.Drag.dragDistanceY=t.pageY-i.TranslationMode.Drag.dragStartY;var e=$("#image"),a=e.offset(),n=e.width()-i.TranslationMode.Drag.dragStartX+a.left-1,o=a.left-i.TranslationMode.Drag.dragStartX,r=e.height()-i.TranslationMode.Drag.dragStartY+a.top-1,s=a.top-i.TranslationMode.Drag.dragStartY;i.TranslationMode.Drag.dragDistanceX>n?i.TranslationMode.Drag.dragDistanceX=n:i.TranslationMode.Drag.dragDistanceX<o&&(i.TranslationMode.Drag.dragDistanceX=o),i.TranslationMode.Drag.dragDistanceY>r?i.TranslationMode.Drag.dragDistanceY=r:i.TranslationMode.Drag.dragDistanceY<s&&(i.TranslationMode.Drag.dragDistanceY=s),Math.abs(i.TranslationMode.Drag.dragDistanceX)>9&&Math.abs(i.TranslationMode.Drag.dragDistanceY)>9&&(i.TranslationMode.Drag.dragging=!0),i.TranslationMode.Drag.dragging&&(i.TranslationMode.Drag.dragDistanceX>=0?(i.TranslationMode.Drag.x=i.TranslationMode.Drag.dragStartX,i.TranslationMode.Drag.w=i.TranslationMode.Drag.dragDistanceX):(i.TranslationMode.Drag.x=i.TranslationMode.Drag.dragStartX+i.TranslationMode.Drag.dragDistanceX,i.TranslationMode.Drag.w=-i.TranslationMode.Drag.dragDistanceX),i.TranslationMode.Drag.dragDistanceY>=0?(i.TranslationMode.Drag.y=i.TranslationMode.Drag.dragStartY,i.TranslationMode.Drag.h=i.TranslationMode.Drag.dragDistanceY):(i.TranslationMode.Drag.y=i.TranslationMode.Drag.dragStartY+i.TranslationMode.Drag.dragDistanceY,i.TranslationMode.Drag.h=-i.TranslationMode.Drag.dragDistanceY),$("#note-preview").css({display:"block",left:i.TranslationMode.Drag.x+1,top:i.TranslationMode.Drag.y+1,width:i.TranslationMode.Drag.w-3,height:i.TranslationMode.Drag.h-3}))},stop:function(t){1===t.which&&0!==i.TranslationMode.Drag.dragStartX&&($(document).off("mousemove",i.TranslationMode.Drag.drag),i.TranslationMode.Drag.dragging?($("#note-preview").css({display:"none"}),i.TranslationMode.create_note(t,i.TranslationMode.Drag.x,i.TranslationMode.Drag.y,i.TranslationMode.Drag.w-1,i.TranslationMode.Drag.h-1),i.TranslationMode.Drag.dragging=!1):i.Box.toggle_all(),i.TranslationMode.Drag.dragStartX=0,i.TranslationMode.Drag.dragStartY=0)}}},id:"x",dragging:!1,editing:!1,timeouts:[],pending:{},add:function(t,e,a,n,o,r,s,l){var c=i.Box.create(e),d=i.Body.create(e);c.data("x",a),c.data("y",n),c.data("width",o),c.data("height",r),t.appendChild(c[0]),t.appendChild(d[0]),d.data("original-body",s),i.Box.scale(c),i.Body.display_text(d,l),i.embed&&i.Body.display_text(c.children("div.note-box-inner-border"),l)},create:function(t,e,a,n){var o=i.Box.create(i.id),r=i.Body.create(i.id);o.css({top:e,left:t,width:a,height:n}),i.Box.update_data_attributes(o),o.find(".note-box-inner-border").addClass("unsaved"),r.html("<em>Click to edit</em>"),$("#note-container").append(o),$("#note-container").append(r),i.Box.resize_inner_border(o),i.id+="x"},clear_timeouts:function(){$.each(i.timeouts,(function(t,e){clearTimeout(e)})),i.timeouts=[]},load_all:function(){var t=document.createDocumentFragment();$.each($("#notes article"),(function(e,a){var n=$(a);i.add(t,n.data("id"),n.data("x"),n.data("y"),n.data("width"),n.data("height"),n.data("body"),n.html())})),$("#note-container").append(t),i.embed&&$.each($(".note-box"),(function(t,e){i.Box.resize_inner_border($(e))}))},initialize_all:function(){0===$("#c-posts #a-show #image").length||$("video#image").length||(i.embed="true"===n.default.meta("post-has-embedded-notes"),i.load_all(),this.initialize_shortcuts(),this.initialize_highlight(),$(document).on("hashchange.danbooru.note",this.initialize_highlight))},initialize_shortcuts:function(){$("#translate").on("click.danbooru",i.TranslationMode.toggle),$("#image").on("click.danbooru",i.Box.toggle_all)},initialize_highlight:function(){var t=window.location.hash.match(/^#note-(\d+)$/);if(t){var e=i.Box.find(t[1]);i.Box.show_highlighted(e)}}};$((function(){i.initialize_all()})),e.default=i},8841:function(t,e,a){"use strict";a.r(e);var n=a(8505);a(2526),a(3870);var i={dialog_setup:!1,initialize_all:function(){$("#c-pool-import").length&&this.initialize_import(),$("#c-posts").length&&$("#a-show").length&&this.initialize_add_to_pool_link(),$("#c-pool-orders,#c-favorite-group-orders").length&&this.initialize_simple_edit()},initialize_import:function(){$("#pool-import-preview-button").on("click",(function(t){i.import_preview(t)}))},import_preview:function(t){var e=$("#pool-import-tags-field").val(),a=$(t.target).data("pid");$.ajax({type:"get",url:"/pools/".concat(a,"/import_preview.json"),data:{tags:e},dataType:"json"}).done((function(t){var e=t.posts.map((function(t){return'<li class="ui-state-default" id="import[post_ids]_'.concat(t.id,'">').concat(t.html,"</li>")}));$("#sortable-posts").html(e.join("")),$("#sortable-posts.ui-sortable").length&&$("#sortable-posts").sortable("destroy"),$("#sortable-posts").sortable({placeholeder:"ui-state-placeholder"}),$("#sortable-posts").disableSelection(),$("#importing-form").off("submit").submit((function(t){t.preventDefault(),$.ajax({type:"post",url:t.target.action,data:$("#sortable-posts").sortable("serialize")+"&"+$(t.target).serialize()}).done((function(){window.location.assign("")}))}))})).fail((function(t){n.default.error("Failed to get posts for import.")}))},initialize_add_to_pool_link:function(){$("#pool").on("click.danbooru",(function(t){i.dialog_setup||($("#add-to-pool-dialog").dialog({autoOpen:!1}),i.dialog_setup=!0),t.preventDefault(),$("#add-to-pool-dialog").dialog("open")})),$("#recent-pools li").on("click.danbooru",(function(t){t.preventDefault(),$("#pool_name").val($(this).attr("data-value"))}))},initialize_simple_edit:function(){$("#sortable").sortable({placeholder:"ui-state-placeholder"}),$("#sortable").disableSelection(),$("#ordering-form").submit((function(t){$.ajax({type:"put",url:t.target.action,data:$("#sortable").sortable("serialize")+"&"+$(t.target).serialize()}),t.preventDefault()}))}};$(document).ready((function(){i.initialize_all()})),e.default=i},3136:function(t,e,a){"use strict";function n(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(!t)return;if("string"===typeof t)return i(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return i(t,e)}(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){l=!0,r=t},f:function(){try{s||null==a.return||a.return()}finally{if(l)throw r}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}a.r(e);var o={init:function(){var t=$("#reason"),e=t.val()+"",a=$("a.delreason-button").on("click",(function(e){e.stopPropagation(),e.preventDefault();var a=$(e.target);if(a.is("a")){var n=a.data("processed");t.val((function(t,e){return e=e.trim(),a.hasClass("enabled")?e.replace(n,"").replace(/ \/ $|^ \/ /g,"").replace(/( \/ ){2,}/g," / "):(e?e+" / ":"")+n})),t.trigger("input")}})).on("e621:refresh",(function(t){var a,i=$(t.target),o=i.data("text"),r=n(i.find("input[type=text]"));try{for(r.s();!(a=r.n()).done;){var s=a.value;o=o.replace("%ID%",$(s).val())}}catch(l){r.e(l)}finally{r.f()}i.data("processed",o),i.toggleClass("enabled",e.indexOf(o)>=0)})).each((function(t,e){var a=$(e);a.find("input[type=text]").on("input",(function(){a.trigger("e621:refresh")}))}));a.trigger("e621:refresh"),t.on("input",(function(){e=t.val()+"",a.trigger("e621:refresh")})),$("#delreason-clear").on("click",(function(){t.val("").trigger("input")}))}};$((function(){$("div#c-confirm-delete").length&&Danbooru.PostDeletion.init()})),e.default=o},8764:function(t,e,a){"use strict";a.r(e);var n=a(8505),i=a(5669),o=a(3263),r=a(8565),s=a(3529),l=a(3966),c=a(9633),d={initialize:function(){($("#c-posts").length||$("#c-favorites").length||$("#c-pools").length)&&(this.initialize_selector(),this.initialize_preview_link(),this.initialize_edit_form(),this.initialize_tag_script_field(),this.initialize_shortcuts(),d.change())},initialize_shortcuts:function(){n.default.keydown("1 2 3 4 5 6 7 8 9 0","change_tag_script",d.change_tag_script)},show_notice:function(t){n.default.notice("Switched to tag script #"+t+". To switch tag scripts, use the number keys.")},change_tag_script:function(t){if("tag-script"===$("#mode-box-mode").val()){var e=i.default.get("current_tag_script_id")||"1",a=parseInt(t.key,10),n=i.default.get("tag-script-"+a);$("#tag-script-field").val(n),i.default.put("current_tag_script_id",a),e!==a&&d.show_notice(a),t.preventDefault()}},initialize_selector:function(){i.default.get("mode")?$("#mode-box-mode").val(i.default.get("mode")):(i.default.put("mode","view"),$("#mode-box-mode").val("view")),$("#mode-box-mode").on("change.danbooru",(function(t){d.change(),$("#tag-script-field:visible").focus().select()}))},initialize_preview_link:function(){$(".post-preview a").on("click.danbooru",d.click)},initialize_edit_form:function(){$("#quick-edit-div").hide(),$("#quick-edit-form input[value=Cancel]").on("click.danbooru",(function(t){d.close_edit_form(),t.preventDefault()})),$("#quick-edit-form").on("submit.danbooru",(function(t){$.ajax({type:"put",url:$("#quick-edit-form").attr("action"),data:{post:{tag_string:$("#post_tag_string").val()}},complete:function(){$.rails.enableFormElements($("#quick-edit-form"))},success:function(t){o.default.update_data(t),n.default.notice("Post #"+t.post.id+" updated"),d.close_edit_form()}}),t.preventDefault()}))},close_edit_form:function(){n.default.disableShortcuts=!1,$("#quick-edit-div").slideUp("fast"),"true"===n.default.meta("enable-auto-complete")&&$("#post_tag_string").data("uiAutocomplete").close()},initialize_tag_script_field:function(){$("#tag-script-field").blur((function(t){var e=$(this).val(),a=i.default.get("current_tag_script_id");i.default.put("tag-script-"+a,e)}))},update_sets_menu:function(){var t=$("#set-id");t.off("change"),c.SendQueue.add((function(){$.ajax({type:"GET",url:"/post_sets/for_select.json"}).fail((function(t){$(window).trigger("danbooru:error","Error getting sets list: "+t.message)})).done((function(e){t.on("change",(function(t){i.default.put("set",t.target.value)})),t.empty();var a=i.default.get("set")||0;["Owned","Maintained"].forEach((function(n){var i=$("<optgroup>",{label:n});e[n].forEach((function(t){i.append($("<option>",{value:t[1],selected:t[1]==a}).text(t[0]))})),t.append(i)}))}))}))},change:function(){$("#quick-edit-div").slideUp("fast");var t=$("#mode-box-mode").val();if(void 0!==t){var e=$("#page");if(e.removeClass((function(t,e){return e.split(/ /).filter((function(t){return/^mode-/.test(t)})).join(" ")})),e.addClass("mode-"+t),i.default.put("mode",t,1),$("#set-id").hide(),$("#tag-script-field").hide(),$("#quick-mode-reason").hide(),"tag-script"===t){var a=i.default.get("current_tag_script_id");a||(a="1",i.default.put("current_tag_script_id",a));var n=i.default.get("tag-script-"+a);$("#tag-script-field").val(n).show(),d.show_notice(a)}else"add-to-set"===t||"remove-from-set"===t?(d.update_sets_menu(),$("#set-id").show()):"delete"===t&&$("#quick-mode-reason").show()}},open_edit:function(t){n.default.disableShortcuts=!0;var e=$("#post_"+t);$("#quick-edit-div").slideDown("fast"),$("#quick-edit-form").attr("action","/posts/"+t+".json"),$("#post_tag_string").val(e.data("tags")+" ").focus().selectEnd(),$("#post_tag_string").height(80);var a=$("#post_tag_string").innerHeight()-$("#post_tag_string").height(),i=$("#post_tag_string").prop("scrollHeight")-a;$("#post_tag_string").height(i)},click:function(t){var e=$("#mode-box-mode").val(),a=$(t.target).closest("article").data("id");if("add-fav"===e)r.default.create(a);else if("remove-fav"===e)r.default.destroy(a);else if("edit"===e)d.open_edit(a);else if("vote-down"===e)o.default.vote(a,-1,!0);else if("vote-up"===e)o.default.vote(a,1,!0);else if("add-to-set"===e)s.default.add_post($("#set-id").val(),a);else if("remove-from-set"===e)s.default.remove_post($("#set-id").val(),a);else if("rating-q"===e)o.default.update(a,{"post[rating]":"q"});else if("rating-s"===e)o.default.update(a,{"post[rating]":"s"});else if("rating-e"===e)o.default.update(a,{"post[rating]":"e"});else if("lock-rating"===e)o.default.update(a,{"post[is_rating_locked]":"1"});else if("lock-note"===e)o.default.update(a,{"post[is_note_locked]":"1"});else if("delete"===e)o.default.delete_with_reason(a,$("#quick-mode-reason").val(),!1);else if("undelete"===e)o.default.undelete(a);else if("approve"===e)o.default.approve(a);else if("remove-parent"===e)o.default.update(a,{"post[parent_id]":""});else{if("tag-script"!==e)return;var n=i.default.get("current_tag_script_id"),c=i.default.get("tag-script-"+n);if(!c)return void t.preventDefault();var u=$("#post_"+a).data("tags").split(" "),p=new Set(u),f=l.default.run(p,c);o.default.tagScript(a,f)}t.preventDefault()}};$((function(){d.initialize()})),e.default=d},3529:function(t,e,a){"use strict";a.r(e);var n=a(9633),i=a(3263),o=a(5669),r={dialog_setup:!1,add_post:function(t,e){i.default.notice_update("inc"),n.SendQueue.add((function(){$.ajax({type:"POST",url:"/post_sets/"+t+"/add_posts.json",data:{post_ids:[e]}}).fail((function(t){var e=$.map(t.responseJSON.errors,(function(t,e){return t})).join("; ");i.default.notice_update("dec"),$(window).trigger("danbooru:error","Error: "+e)})).done((function(){i.default.notice_update("dec"),$(window).trigger("danbooru:notice","Added post to set")}))}))},remove_post:function(t,e){i.default.notice_update("inc"),n.SendQueue.add((function(){$.ajax({type:"POST",url:"/post_sets/"+t+"/remove_posts.json",data:{post_ids:[e]}}).fail((function(t){var e=$.map(t.responseJSON.errors,(function(t,e){return t})).join("; ");i.default.notice_update("dec"),$(window).trigger("danbooru:error","Error: "+e)})).done((function(){i.default.notice_update("dec"),$(window).trigger("danbooru:notice","Removed post from set")}))}))},initialize_add_to_set_link:function(){$("#set").on("click.danbooru",(function(t){r.dialog_setup||($("#add-to-set-dialog").dialog({autoOpen:!1}),r.dialog_setup=!0),t.preventDefault(),r.update_sets_menu(),$("#add-to-set-dialog").dialog("open")})),$("#add-to-set-submit").on("click",(function(t){t.preventDefault();var e=$("#image-container").data("id");r.add_post($("#add-to-set-id").val(),e),$("#add-to-set-dialog").dialog("close")}))},update_sets_menu:function(){var t=$("#add-to-set-id");t.empty(),t.append($("<option>").text("Loading...")),t.off("change"),n.SendQueue.add((function(){$.ajax({type:"GET",url:"/post_sets/for_select.json"}).fail((function(t){$(window).trigger("danbooru:error","Error getting sets list: "+t.message)})).done((function(e){t.on("change",(function(t){o.default.put("set",t.target.value)}));var a=o.default.get("set")||0;t.empty(),["Owned","Maintained"].forEach((function(n){var i=$("<optgroup>",{label:n});e[n].forEach((function(t){i.append($("<option>",{value:t[1],selected:t[1]==a}).text(t[0]))})),t.append(i)}))}))}))}};$((function(){$("#c-posts").length&&$("#a-show").length&&r.initialize_add_to_set_link()})),e.default=r},5597:function(t,e,a){"use strict";a.r(e);var n=a(8505),i=a(9633),o=a(3263);function r(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(!t)return;if("string"===typeof t)return s(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return s(t,e)}(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,l=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return r=t.done,t},e:function(t){l=!0,o=t},f:function(){try{r||null==a.return||a.return()}finally{if(l)throw o}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var l={updated:0,initialize_all:function(){$("#c-post-versions #a-index").length&&(l.initialize_undo(),$("#subnav-select-all-link").on("click",(function(t){t.preventDefault(),$(".post-version-select:not(:disabled)").prop("checked",!0).change()})),$("#subnav-apply-tag-script-to-selected-link").on("click",l.tag_script_selected))},initialize_undo:function(){$(".post-version-row-select").on("click.danbooru",(function(t){$(t.target).find(".post-version-select:not(:disabled)").prop("checked",(function(t,e){return!e})).change()})),$("#post-version-select-all").on("change.danbooru",(function(t){$(".post-version-select:not(:disabled)").prop("checked",$("#post-version-select-all").prop("checked")).change()})),$(".post-version-select").on("change.danbooru",(function(t){var e=$(".post-version-select:checked");$("#subnav-undo-selected-link").text("Undo selected (".concat(e.length,")")).toggle(e.length>0)})),$("#subnav-undo-selected-link").on("click.danbooru",l.undo_selected)},undo_selected:function(){event.preventDefault(),l.updated=0;var t,e=$(".post-version-select:checked").parents(".post-version"),a=r(e);try{var o=function(){var a=t.value,o=$(a).data("post-version-id");i.SendQueue.add((function(){$.ajax("/post_versions/".concat(o,"/undo.json"),{method:"PUT"}),n.default.notice("".concat(++l.updated,"/").concat(e.length," changes undone."))}))};for(a.s();!(t=a.n()).done;)o()}catch(s){a.e(s)}finally{a.f()}},tag_script_selected:function(){event.preventDefault(),l.updated=0;var t=$(".post-version-select:checked").parents(".post-version"),e=$("#update-tag-script").val();if(e){var a,s=r(t);try{var c=function(){var r=a.value,s=$(r).data("post-id");i.SendQueue.add((function(){o.default.tagScript(s,e),n.default.notice("".concat(++l.updated,"/").concat(t.length," changes applied."))}))};for(s.s();!(a=s.n()).done;)c()}catch(d){s.e(d)}finally{s.f()}}}};$(document).ready(l.initialize_all),e.default=l},3263:function(t,e,a){"use strict";a.r(e);var n=a(8505),i=a(1596),o=a.n(i),r=a(5669),s=a(8555),l=a(9633);function c(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||d(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){if(t){if("string"===typeof t)return u(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function p(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,e){return f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},f(t,e)}function g(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=v(t);if(e){var i=v(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return h(this,a)}}function h(t,e){if(e&&("object"===typeof e||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}var m={pending_update_count:0,resizeMode:"unknown",initialize_all:function(){$("#c-posts").length&&(this.initialize_shortcuts(),this.initialize_collapse()),$("#c-posts").length&&$("#a-index").length&&(this.initialize_excerpt(),this.initialize_gestures()),$("#c-posts").length&&$("#a-show").length&&(this.initialize_links(),this.initialize_post_relationship_previews(),this.initialize_post_sections(),this.initialize_resize(),this.initialize_similar(),this.initialize_gestures(),this.initialize_voting(),this.initialize_moderation()),$("#p-index-by-post").length&&this.initialize_voting(),$("#c-posts #a-show, #c-uploads #a-new").length&&this.initialize_edit_dialog(),$(document).on("danbooru:open-post-edit-tab",(function(){return n.default.disableShortcuts=!0})),$(document).on("danbooru:open-post-edit-tab",(function(){return $("#post_tag_string").focus()})),$(document).on("danbooru:close-post-edit-tab",(function(){return n.default.disableShortcuts=!1}));var t=$('[data-autocomplete="tag-edit"]');t.on("keypress.danbooru",m.update_tag_count),t.on("click",m.update_tag_count)},initialize_moderation:function(){$("#unapprove-post-link").on("click",(function(t){m.unapprove($(t.target).data("pid")),t.preventDefault()})),$(".unflag-post-link").on("click",(function(t){var e=$(t.target);m.unflag(e.data("pid"),e.data("type")),t.preventDefault()}))},initialize_collapse:function(){$(".tag-list-header").on("click",(function(t){var e=$(t.target).data("category");$(".".concat(e,"-tag-list")).toggle(),$(t.target).toggleClass("hidden-category"),t.preventDefault()}))},initialize_voting:function(){$(document).on("click.danbooru.post",".post-vote-up-link",m.vote_up),$(document).on("click.danbooru.post",".post-vote-down-link",m.vote_down)},initialize_edit_dialog:function(){$("#open-edit-dialog").show().on("click.danbooru",(function(t){m.open_edit_dialog(),t.preventDefault()}))},open_edit_dialog:function(){if(1!==$("#edit-dialog").length){$(document).trigger("danbooru:open-post-edit-dialog"),$("#edit").show(),$("#comments").hide(),$("#post-sections li").removeClass("active"),$("#post-edit-link").parent("li").addClass("active");var t=$("#post_tag_string,#upload_tag_string");$("div.input").has(t).prevAll().hide(),$("#open-edit-dialog").hide();var e=$("<div/>").attr("id","edit-dialog");$("#form").appendTo(e),e.dialog({title:"Edit tags",width:.6*$(window).width(),position:{my:"right",at:"right-20",of:window},drag:function(e,a){"true"===n.default.meta("enable-auto-complete")&&t.data("uiAutocomplete").close()},close:m.close_edit_dialog}),e.dialog("widget").draggable("option","containment","none");var a=$("<button/>").button({icons:{primary:"ui-icon-pin-w"},label:"pin",text:!1});a.css({width:"20px",height:"20px",position:"absolute",right:"28.4px"}),e.parent().children(".ui-dialog-titlebar").append(a),a.on("click.danbooru",(function(t){var n=$(".ui-dialog:has(#edit-dialog)"),i=n.offset();"absolute"===n.css("position")?(i.left-=$(window).scrollLeft(),i.top-=$(window).scrollTop(),n.offset(i).css({position:"fixed"}),e.dialog("option","resize",(function(){n.css({position:"fixed"})})),a.button("option","icons",{primary:"ui-icon-pin-s"})):(i.left+=$(window).scrollLeft(),i.top+=$(window).scrollTop(),n.offset(i).css({position:"absolute"}),e.dialog("option","resize",(function(){})),a.button("option","icons",{primary:"ui-icon-pin-w"}))})),e.parent().mouseout((function(t){e.parent().css({opacity:.6,transition:"opacity .4s ease"})})).mouseover((function(t){e.parent().css({opacity:1,transition:"opacity .2s ease"})})),t.css({resize:"none",width:"100%"}),t.focus().selectEnd().height(t[0].scrollHeight)}},close_edit_dialog:function(t,e){$("#form").appendTo($("#c-posts #edit,#c-uploads #a-new")),$("#edit-dialog").remove();var a=$("#post_tag_string,#upload_tag_string");$("div.input").has(a).prevAll().show(),$("#open-edit-dialog").show(),a.css({resize:"",width:""}),$(document).trigger("danbooru:close-post-edit-dialog")},initialize_similar:function(){$("#similar-button").on("click.danbooru",(function(t){$.get("/iqdb_queries",{url:$("#post_source").val()}).done((function(t){$("#iqdb-similar").html(t).show()})),t.preventDefault()}))},has_next_target:function(){return $(".paginator a[rel~=next]").length||$(".search-seq-nav a[rel~=next]").length||$(".pool-nav li.pool-selected-true a[rel~=next], .set-nav a.active[rel~=next]").length},has_prev_target:function(){return $(".paginator a[rel~=prev]").length||$(".search-seq-nav a[rel~=prev]").length||$(".pool-nav li.pool-selected-true a[rel~=prev], .set-nav a.active[rel~=prev]").length}},_=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(o,t);var e,a,n,i=g(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,t)).type="e6swipe",e.minDistance=150,e}return e=o,(a=[{key:"end",value:function(t){function e(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}if(this.numInputs!==t.length)return null;var a=document.activeElement;if(a&&-1!==["INPUT","TEXTAREA","SELECT"].indexOf(a.tagName))return null;var n={data:[]},i=t[0];if("end"!==i.current.type)return null;var o=i.getGestureProgress(this.getId());if(!o.moves||o.moves.length<=2)return null;var r=o.moves[o.moves.length-1];if((new Date).getTime()-r.time>this.maxRestTime)return null;var s=o.moves.reduce((function(t,a,n){if(0===n)return{vel:0,angle:[0,0],dist:0,last:a};var i,o,r=(i=[t.last.x,t.last.y,t.last.time],o=[a.x,a.y,a.time],e([i[0],i[1]],[o[0],o[1]])/(o[2]-i[2])),s=function(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}([t.last.x,t.last.y],[a.x,a.y]),l=e([t.last.x,t.last.y],[a.x,a.y]);return{vel:t.vel+r,angle:[t.angle[0]+Math.cos(s),t.angle[1]+Math.sin(s)],dist:t.dist+l,last:a}}),{vel:0,angle:0,dist:0,last:null}),l=(i.initial,o.moves.length-2),c={vel:s.vel/l,angle:Math.atan2(s.angle[0],s.angle[1])};return n.data[0]={velocity:c.vel,distance:s.dist,duration:1,currentDirection:c.angle},n.data[0].velocity<this.escapeVelocity||n.data[0].distance<this.minDistance?null:n.data.length>0?n:null}}])&&p(e.prototype,a),n&&p(e,n),o}(o().Swipe);function w(t){switch(t.file.ext){case"webm":case"mp4":return!0;default:return!1}}m.initialize_gestures=function(){if("true"===r.default.get("emg")&&("ontouchstart"in window||navigator.maxTouchPoints>0)&&"activeElement"in document){var t=$("body");if(!t.data("zing")){var e=new(o().Region)(document.body,!1,!1);e.bind(document.body,new _,(function(t){var e=180*t.detail.data[0].currentDirection/Math.PI;console.log(e,t.detail.data[0]);var a=m.has_prev_target(),i=m.has_next_target();a&&e>65&&e<115&&($("body").css({"transition-timing-function":"ease","transition-duration":"0.2s",opacity:"0",transform:"translateX(150%)"}),n.default.delay(200).then((function(){m.nav_prev(t)}))),i&&e>-115&&e<-65&&($("body").css({"transition-timing-function":"ease","transition-duration":"0.2s",opacity:"0",transform:"translateX(-150%)"}),n.default.delay(200).then((function(){m.nav_next(t)})))})),t.data("zing",e),$("#image-container").css({overflow:"visible"})}}},m.nav_prev=function(t){var e="";$(".search-seq-nav").length?(e=$(".search-seq-nav a[rel~=prev]").attr("href"))&&(location.href=e):$(".paginator a[rel~=prev]").length?location.href=$("a[rel~=prev]").attr("href"):(e=$(".pool-nav li.pool-selected-true a[rel~=prev], .set-nav li.set-selected-true a[rel~=prev]").attr("href"))&&(location.href=e),t.preventDefault()},m.nav_next=function(t){var e="";$(".search-seq-nav").length?(e=$(".search-seq-nav a[rel~=next]").attr("href"),location.href=e):$(".paginator a[rel~=next]").length?location.href=$(".paginator a[rel~=next]").attr("href"):(e=$(".pool-nav li.pool-selected-true a[rel~=next], .set-nav li.set-selected-true a[rel~=next]").attr("href"))&&(location.href=e),t.preventDefault()},m.initialize_shortcuts=function(){$("#a-show").length&&($("#flash-content").length&&(n.default.disableShortcuts=!0,$("#flash-shortcut-notice").show()),n.default.keydown("a","prev_page",m.nav_prev),n.default.keydown("d","next_page",m.nav_next))},m.initialize_links=function(){$(".undelete-post-link").on("click",(function(t){t.preventDefault(),confirm("Are you sure you want to undelete this post?")&&m.undelete($(t.target).data("pid"))})),$(".approve-post-link").on("click",(function(t){t.preventDefault(),m.approve($(t.target).data("pid"),!0)})),$("#destroy-post-link").on("click",(function(t){t.preventDefault(),confirm("This will permanently delete this post (meaning the file will be deleted). Are you sure you want to delete this post?")&&m.destroy($(t.target).data("pid"))})),$("#regenerate-image-samples-link").on("click",(function(t){t.preventDefault(),m.regenerate_image_samples($(t.target).data("pid"))})),$("#regenerate-video-samples-link").on("click",(function(t){t.preventDefault(),m.regenerate_video_samples($(t.target).data("pid"))})),$(".disapprove-post-link").on("click",(function(t){t.preventDefault();var e=$(t.target);m.disapprove(e.data("pid"),e.data("reason"),!0)})),$("#set-as-avatar-link").on("click.danbooru",(function(t){t.preventDefault(),confirm("Set post as avatar?")&&m.set_as_avatar($(t.target).data("post-id"))})),$("#copy-notes").on("click.danbooru",(function(t){var e=$("meta[name=post-id]").attr("content"),a=parseInt(prompt("Enter the ID of the post to copy all notes to:"),10);null!==a&&$.ajax("/posts/"+e+"/copy_notes",{type:"PUT",data:{other_post_id:a},success:function(t){$(window).trigger("danbooru:notice","Successfully copied notes to <a href='"+a+"'>post #"+a+"</a>")},error:function(t){404===t.status?$(window).trigger("danbooru:error","Error: Invalid destination post"):t.responseJSON&&t.responseJSON.reason?$(window).trigger("danbooru:error","Error: "+t.responseJSON.reason):$(window).trigger("danbooru:error","There was an error copying notes to <a href='"+a+"'>post #"+a+"</a>")}}),t.preventDefault()}))},m.initialize_post_relationship_previews=function(){var t=$("meta[name=post-id]").attr("content");$("[id=post_"+t+"]").addClass("current-post");var e=function(){m.toggle_relationship_preview($("#has-children-relationship-preview"),$("#has-children-relationship-preview-link")),m.toggle_relationship_preview($("#has-parent-relationship-preview"),$("#has-parent-relationship-preview-link"))},a=function(){"1"===r.default.get("show-relationship-previews")?r.default.put("show-relationship-previews","0"):r.default.put("show-relationship-previews","1")};"1"===r.default.get("show-relationship-previews")&&e(),$("#has-children-relationship-preview-link").on("click.danbooru",(function(t){e(),a(),t.preventDefault()})),$("#has-parent-relationship-preview-link").on("click.danbooru",(function(t){e(),a(),t.preventDefault()}))},m.toggle_relationship_preview=function(t,e){t.toggle(),t.is(":visible")?e.html("&laquo; hide"):e.html("show &raquo;")},m.currentPost=function(){return this._currentPost||(this._currentPost=this.fromDOM($("#image-container"))),this._currentPost},m.fromDOM=function(t){if(!t)return{};var e=t.attr("data-post")||"{}";return JSON.parse(e)},m.resize_notes=function(){s.default.Box.scale_all()},m.resize_video=function(t,e){var a,n,i,o,r=$("video#image"),s=r[0];s.pause();var l=$("#image-resize-notice");l.hide();var c,d,u,p,f=[],g=[];function h(){var e,a,n,i,o,r;(f.push({type:"video/webm",url:null===t||void 0===t||null===(e=t.file)||void 0===e?void 0:e.url}),"unknown"!==typeof(null===t||void 0===t||null===(a=t.sample)||void 0===a||null===(n=a.alternates)||void 0===n?void 0:n.original))&&f.push({type:"video/mp4",url:null===t||void 0===t||null===(i=t.sample)||void 0===i||null===(o=i.alternates)||void 0===o||null===(r=o.original)||void 0===r?void 0:r.urls[1]})}switch(e){case"original":h();break;case"fit":h(),g.push("fit-window");break;case"fitv":h(),g.push("fit-window-vertical");break;default:l.show();var v=null===t||void 0===t||null===(a=t.sample)||void 0===a?void 0:a.alternates[e];f.push({type:"video/webm",url:v.urls[0]}),f.push({type:"video/mp4",url:v.urls[1]}),g.push("fit-window"),c=null===t||void 0===t||null===(n=t.sample)||void 0===n||null===(i=n.alternates[e])||void 0===i?void 0:i.width,d=null===t||void 0===t||null===(o=t.file)||void 0===o?void 0:o.width,u=$("#image-resize-size"),p=Math.floor(100*c/d),u.text("".concat(p,"%"))}r.removeClass(),r.empty();for(var m=0,_=f;m<_.length;m++){var w=_[m],b=s.canPlayType(w.type);if("probably"===b||"maybe"===b){w.url!==r.attr("src")&&(r.attr("src",w.url),s.load());break}}for(var y=0,k=g;y<k.length;y++){var x=k[y];r.addClass(x)}},m.resize_image=function(t,e){var a,n,i,o,r,s,l,c,d,u,p,f=$("img#image"),g=$("#image-resize-notice"),h=function(t,e){var a=$("#image-resize-size"),n=Math.floor(100*t/e);a.text("".concat(n,"%"))};g.hide();var v="",_=[];switch(e){case"original":v=null===t||void 0===t||null===(a=t.file)||void 0===a?void 0:a.url;break;case"fit":_.push("fit-window"),v=null===t||void 0===t||null===(n=t.file)||void 0===n?void 0:n.url;break;case"fitv":_.push("fit-window-vertical"),v=null===t||void 0===t||null===(i=t.file)||void 0===i?void 0:i.url;break;case"large":g.show(),_.push("fit-window"),v=null===t||void 0===t||null===(o=t.sample)||void 0===o?void 0:o.url,h(null===t||void 0===t||null===(r=t.sample)||void 0===r?void 0:r.width,null===t||void 0===t||null===(s=t.file)||void 0===s?void 0:s.width);break;default:g.show(),_.push("fit-window"),v=null===t||void 0===t||null===(l=t.sample)||void 0===l||null===(c=l.alternates[e])||void 0===c?void 0:c.url,h(null===t||void 0===t||null===(d=t.sample)||void 0===d||null===(u=d.alternates[e])||void 0===u?void 0:u.width,null===t||void 0===t||null===(p=t.file)||void 0===p?void 0:p.width)}f.removeClass(),f.attr("src")!==v&&($("#image-container").addClass("image-loading"),f.attr("src",v));for(var w=0,b=_;w<b.length;w++){var y=b[w];f.addClass(y)}m.resize_notes()},m.resize_to=function(t){if(t=function(t){var e=$("#image-resize-selector"),a=e.find("option");if("next"===t){var n=e[0].selectedIndex,i=$(a[(n+1)%a.length]).val();return e.val(i),i}var o,r=function(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=d(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return r=t.done,t},e:function(t){s=!0,o=t},f:function(){try{r||null==a.return||a.return()}finally{if(s)throw o}}}}(a);try{for(r.s();!(o=r.n()).done;){var s=o.value;if($(s).val()==t)return e.val(t),t}}catch(l){r.e(l)}finally{r.f()}return e.val("fit"),"fit"}(t),!$("#image-container").hasClass("blacklisted-active-visible")){var e=m.currentPost();w(e)?m.resize_video(e,t):m.resize_image(e,t)}},m.initialize_resize=function(){var t;m.initialize_change_resize_mode_link();var e=m.currentPost();if("swf"!==(null===e||void 0===e||null===(t=e.file)||void 0===t?void 0:t.ext)){var a=w(e);if(!a){var i=$("img#image");i.length>0&&i[0]&&i[0].complete&&m.resize_notes(),i.on("load",(function(t){m.resize_notes(),$("#image-container").removeClass("image-loading")})),$(window).on("resize",m.resize_notes)}var o=n.default.meta("image-override-size")||n.default.meta("default-image-size");a&&"large"===o&&(o=function(t){var e,a,n=Object.entries(m.currentPost().sample.alternates);return 0===(n=n.filter((function(t){return"original"!==t[0]}))).length||(null===t||void 0===t||null===(e=t.file)||void 0===e?void 0:e.width)<=1280&&(null===t||void 0===t||null===(a=t.file)||void 0===a?void 0:a.height)<=720?"fit":n.map((function(t){return[t[0],Math.abs(window.outerHeight-t[1].height)*Math.abs(window.outerWidth-t[1].width)]})).sort((function(t,e){return t[1]<e[1]?-1:1}))[0][0]}(e)),m.resize_to(o);var r=$("#image-resize-selector");r.on("change",(function(){return m.resize_to(r.val())}))}},m.resize_cycle_mode=function(t){t&&t.target&&t.preventDefault(),$("#image-container").hasClass("blacklisted-active-visible")||m.resize_to("next")},m.initialize_change_resize_mode_link=function(){$("#image-resize-link").on("click",(function(t){t.preventDefault(),m.resize_to("fit")})),n.default.keydown("v","resize",m.resize_cycle_mode)},m.initialize_excerpt=function(){$("#excerpt").hide(),$("#show-posts-link").on("click.danbooru",(function(t){$("#show-posts-link").parent("li").addClass("active"),$("#show-excerpt-link").parent("li").removeClass("active"),$("#posts").show(),$("#excerpt").hide(),t.preventDefault()})),$("#show-excerpt-link").on("click.danbooru",(function(t){$(this).parent("li").hasClass("active")||($("#show-posts-link").parent("li").removeClass("active"),$("#show-excerpt-link").parent("li").addClass("active"),$("#posts").hide(),$("#excerpt").show(),t.preventDefault())})),!$(".post-preview").length&&/Nobody here but us chickens/.test($("#posts").html())&&$("#show-excerpt-link").click()},m.initialize_post_sections=function(){$("#post-sections li a,#side-edit-link").on("click.danbooru",(function(t){"#comments"===t.target.hash?($("#comments").show(),$("#edit").hide()):"#edit"===t.target.hash?($("#edit").show(),$("#comments").hide(),$(document).trigger("danbooru:open-post-edit-tab"),m.update_tag_count({target:$("#post_tag_string")})):($("#edit").hide(),$("#comments").hide()),"#edit"!==t.target.hash&&$(document).trigger("danbooru:close-post-edit-tab"),$("#post-sections li").removeClass("active"),$(t.target).parent("li").addClass("active"),t.preventDefault()}))},m.resize_ugoira_controls=function(){var t=$("#image"),e=Math.max(t.width(),350);$("#ugoira-control-panel").css("width",e),$("#seek-slider").css("width",e-81)},m.notice_update=function(t){"inc"===t?(m.pending_update_count+=1,$(window).trigger("danbooru:notice","Updating posts ("+m.pending_update_count+" pending)...",!0)):(m.pending_update_count-=1,m.pending_update_count<1?$(window).trigger("danbooru:notice","Posts updated"):$(window).trigger("danbooru:notice","Updating posts ("+m.pending_update_count+" pending)...",!0))},m.update_data=function(t){var e=$("#post_"+t.id);e.attr("data-tags",t.tag_string),e.data("rating",t.rating),e.removeClass("post-status-has-parent post-status-has-children"),t.parent_id&&e.addClass("post-status-has-parent"),t.has_visible_children&&e.addClass("post-status-has-children")},m.tag=function(t,e){var a=Array.isArray(e)?e.join(" "):String(e);m.update(t,{"post[old_tag_string]":"","post[tag_string]":a})},m.tagScript=function(t,e){var a=Array.isArray(e)?e.join(" "):String(e);m.update(t,{"post[tag_string_diff]":a})},m.update=function(t,e){m.notice_update("inc"),l.SendQueue.add((function(){$.ajax({type:"PUT",url:"/posts/"+t+".json",data:e,success:function(t){m.notice_update("dec"),m.update_data(t)},error:function(e){m.notice_update("dec"),$(window).trigger("danbooru:error",'There was an error updating <a href="/posts/'+t+'">post #'+t+"</a>")}})}))},m.delete_with_reason=function(t,e,a){m.notice_update("inc"),l.SendQueue.add((function(){$.ajax({type:"POST",url:"/moderator/post/posts/".concat(t,"/delete.json"),data:{commit:"Delete",reason:e,move_favorites:!0}}).fail((function(t){var e=$.map(t.responseJSON.errors,(function(t,e){return t})).join("; ");$(window).trigger("danbooru:error","Error: "+e)})).done((function(e){$(window).trigger("danbooru:notice","Deleted post."),a?location.reload():$("article#post_".concat(t)).attr("data-flags","deleted")})).always((function(){m.notice_update("dec")}))}))},m.undelete=function(t){m.notice_update("inc"),l.SendQueue.add((function(){$.ajax({type:"POST",url:"/moderator/post/posts/".concat(t,"/undelete.json")}).fail((function(t){var e=t.responseJSON.message;$(window).trigger("danbooru:error","Error: "+e)})).done((function(e){$(window).trigger("danbooru:notice","Deleted post."),$("article#post_".concat(t)).attr("data-flags","active")})).always((function(){m.notice_update("dec")}))}))},m.unflag=function(t,e){m.notice_update("inc");var a=e||"none";l.SendQueue.add((function(){$.ajax({type:"DELETE",url:"/posts/".concat(t,"/flag.json"),data:{approval:a}}).fail((function(t){var e=t.responseJSON.message;$(window).trigger("danbooru:error","Error: "+e)})).done((function(t){$(window).trigger("danbooru:notice","Unflagged post"),location.reload()})).always((function(){m.notice_update("dec")}))}))},m.unapprove=function(t){m.notice_update("inc"),l.SendQueue.add((function(){$.ajax({type:"DELETE",url:"/moderator/post/approval.json",data:{post_id:t}}).fail((function(t){var e=$.map(t.responseJSON.errors,(function(t,e){return t})).join("; ");$(window).trigger("danbooru:error","Error: "+e)})).done((function(t){$(window).trigger("danbooru:notice","Unapproved post."),location.reload()})).always((function(){m.notice_update("dec")}))}))},m.destroy=function(t){$.post("/moderator/post/posts/".concat(t,"/expunge.json"),{}).fail((function(t){var e=$.map(t.responseJSON.errors,(function(t,e){return t})).join("; ");$(window).trigger("danbooru:error","Error: "+e)})).done((function(t){location.reload()}))},m.regenerate_image_samples=function(t){$.post("/moderator/post/posts/".concat(t,"/regenerate_thumbnails.json"),{}).fail((function(t){n.default.error("Error: "+t.responseJSON.reason)})).done((function(t){n.default.notice("Image samples regenerated.")}))},m.regenerate_video_samples=function(t){$.post("/moderator/post/posts/".concat(t,"/regenerate_videos.json"),{}).fail((function(t){n.default.error("Error: "+t.responseJSON.reason)})).done((function(t){n.default.notice("Video samples will be regenerated in a few minutes.")}))},m.approve=function(t,e){m.notice_update("inc"),l.SendQueue.add((function(){$.post("/moderator/post/approval.json",{post_id:t}).fail((function(t){var e=$.map(t.responseJSON.errors,(function(t,e){return t})).join("; ");$(window).trigger("danbooru:error","Error: "+e)})).done((function(a){if($("#c-moderator-post-queues").length)return $("#c-moderator-post-queues #post-".concat(t)).hide(),$(window).trigger("danbooru:modqueue_increment_processed"),void $(window).trigger("danbooru:notice","Post was approved");var n=$("#post_"+t);n.length&&(n.data("flags",n.data("flags").replace(/pending/,"")),n.removeClass("post-status-pending"),$(window).trigger("danbooru:notice","Approved post #"+t)),!0===e&&location.reload()})).always((function(){m.notice_update("dec")}))}))},m.disapprove=function(t,e,a){m.notice_update("inc"),l.SendQueue.add((function(){$.post("/moderator/post/disapprovals.json",{"post_disapproval[post_id]":t,"post_disapproval[reason]":e}).fail((function(t){var e=$.map(t.responseJSON.errors,(function(t,e){return t})).join("; ");$(window).trigger("danbooru:error","Error: "+e)})).done((function(e){$("#c-posts #a-show").length?location.reload():$("#c-moderator-post-queues").length&&($("#c-moderator-post-queues #post-".concat(t)).hide(),$(window).trigger("danbooru:modqueue_increment_processed"),$(window).trigger("danbooru:notice","Post was hidden"))})).always((function(){m.notice_update("dec")}))}))},m.update_tag_count=function(t){var e="0 tags",a=0;if(t){var n=c(new Set($(t.target).val().match(/\S+/g)));n&&(e=1==(a=n.length)?a+" tag":a+" tags")}$("#tags-container .count").html(e);var i="smile";a<15?i="frown":a<25&&(i="meh"),$("#tags-container .options #face").removeClass().addClass("far fa-".concat(i))},m.vote_up=function(t){var e=$(t.target).parent().attr("data-id");m.vote(e,1)},m.vote_down=function(t){var e=$(t.target).parent().attr("data-id");m.vote(e,-1)},m.vote=function(t,e,a){m.notice_update("inc"),l.SendQueue.add((function(){$.ajax({method:"POST",url:"/posts/".concat(t,"/votes.json"),data:{score:e,no_unvote:!0===a},dataType:"json",headers:{accept:"*/*;q=0.5,text/javascript"}}).done((function(e){var a,n="score-neutral score-positive score-negative",i=t,o=e.score,r=e.our_score;$(".post-score-"+i).removeClass(n),$(".post-vote-up-"+i).removeClass(n),$(".post-vote-down-"+i).removeClass(n),$(".post-score-"+i).text(o),$(".post-score-"+i).attr("title","".concat(e.up," up/").concat(e.down," down")),$(".post-score-"+i).addClass(0==(a=o)?"score-neutral":a>0?"score-positive":"score-negative"),$(".post-vote-up-"+i).addClass(r>0?"score-positive":"score-neutral"),$(".post-vote-down-"+i).addClass(r<0?"score-negative":"score-neutral"),$(window).trigger("danbooru:notice","Vote saved")})).always((function(){m.notice_update("dec")}))}))},m.set_as_avatar=function(t){l.SendQueue.add((function(){$.ajax({method:"PATCH",url:"/users/".concat(n.default.meta("current-user-id"),".json"),data:{"user[avatar_id]":t},headers:{accept:"*/*;q=0.5,text/javascript"}}).done((function(t){$(window).trigger("danbooru:notice","Post set as avatar")}))}))},$(document).ready((function(){m.initialize_all()})),e.default=m},3107:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return g}});var n=a(8505),i=a(3263),o=a(144),r=a(2453),s=a(3269),l=a(5903);function c(t,e){return t[0]>e[0]?1:-1}var d={components:{"related-tags":r.Z,"tag-preview":s.Z},data:function(){return{preview:{loading:!1,show:!1,tags:[]},expandRelated:!0,tags:window.uploaderSettings.postTags,relatedTags:[],loadingRelated:!1}},mounted:function(){"true"===n.default.meta("enable-auto-complete")&&l.default.initialize_tag_autocomplete()},computed:{tagsArray:function(){return this.tags.toLowerCase().replace(/\r?\n|\r/g," ").split(" ")},relatedText:function(){return this.expandRelated?"<<":">>"}},methods:{updateTagCount:function(){i.default.update_tag_count({target:$("#post_tag_string")})},toggleRelated:function(){this.expandRelated=!this.expandRelated},pushTag:function(t,e){if(this.preview.show=!1,e){-1===this.tags.toLowerCase().trim().replace(/\r?\n|\r/g," ").split(" ").indexOf(t)&&(this.tags.length&&" "!==this.tags[this.tags.length-1]&&(this.tags+=" "),this.tags+=t+" ")}else{for(var a=this.tags.toLowerCase().split(/\r?\n|\r/g),n=0;n<a.length;++n){var r=a[n].trim().split(" ").filter((function(t){return t.trim().length})),s=r.indexOf(t);if(e)-1===s&&r.push(t);else{if(-1===s)continue;r.splice(s,1)}a[n]=r.join(" ")}this.tags=a.join("\n")+" "}o.Z.nextTick((function(){i.default.update_tag_count({target:$("#post_tag_string")})}))},previewFinalTags:function(){if(!this.preview.loading)if(this.preview.show)this.preview.show=!1;else{this.preview.loading=!0,this.preview.show=!0,this.preview.tags=[];var t=this,e={tags:this.tags};$.ajax("/tags/preview.json",{method:"POST",type:"POST",data:e,success:function(e){t.preview.loading=!1,t.preview.tags=e},error:function(e){t.preview.loading=!1,t.preview.tags=[],t.preview.show=!1,Danbooru.error("Error loading tag preview "+e)}})}},findRelated:function(t){var e=this;e.expandRelated=!0;this.loadingRelated=!0,this.relatedTags=[];var a=function(){var t=e.$refs.otherTags;if(console.log(t.hasOwnProperty("selectionStart")),console.log(t.selectionStart),"undefined"===typeof t.selectionStart)return null;var a=t.selectionEnd-t.selectionStart;return a?t.value.substr(t.selectionStart,a):null}(),n=a?{query:a}:{query:this.tags};t&&(n.category=t),$.ajax("/related_tag/bulk.json",{method:"POST",type:"POST",data:n,dataType:"json",success:function(t){e.relatedTags=function(t){var e=[];for(var a in t)t.hasOwnProperty(a)&&t[a].length&&e.push({title:"Related: "+a,tags:t[a].sort(c)});return e}(t)}}).always((function(){e.loadingRelated=!1}))}}},u=(0,a(1900).Z)(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.preview.show,expression:"!preview.show"}]},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.tags,expression:"tags"}],ref:"otherTags",staticClass:"tag-textarea",attrs:{id:"post_tag_string",rows:"5","data-autocomplete":"tag-edit",name:"post[tag_string]",spellcheck:"false"},domProps:{value:t.tags},on:{keyup:t.updateTagCount,input:function(e){e.target.composing||(t.tags=e.target.value)}}})]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.preview.show,expression:"preview.show"}]},[a("tag-preview",{attrs:{tags:t.preview.tags,loading:t.preview.loading},on:{close:t.previewFinalTags}})],1),t._v(" "),a("div",{staticClass:"related-tag-functions"},[t._v("\n        Related:\n        "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated()}}},[t._v("Tags")]),t._v(" |\n        "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated("artist")}}},[t._v("Artists")]),t._v(" |\n        "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated("copyright")}}},[t._v("Copyrights")]),t._v(" |\n        "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated("char")}}},[t._v("Characters")]),t._v(" |\n        "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated("species")}}},[t._v("Species")]),t._v(" |\n        "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated("meta")}}},[t._v("Metatags")]),t._v(" |\n        "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.previewFinalTags.apply(null,arguments)}}},[t._v("Preview Final Tags")])]),t._v(" "),a("div",[a("h3",[t._v("Related Tags "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleRelated.apply(null,arguments)}}},[t._v(t._s(t.relatedText))])]),t._v(" "),a("related-tags",{directives:[{name:"show",rawName:"v-show",value:t.expandRelated,expression:"expandRelated"}],attrs:{tags:t.tagsArray,related:t.relatedTags,loading:t.loadingRelated},on:{"tag-active":t.pushTag}})],1)])}),[],!1,null,null,null),p=u.exports,f={initialize_all:function(){$(document).on("click.danbooru",".related-tags-button",f.on_click_related_tags_button),$(document).on("click.danbooru",".related-tags a.search-tag",f.toggle_tag),$(document).on("click.danbooru","#show-related-tags-link",f.show),$(document).on("click.danbooru","#hide-related-tags-link",f.hide),$(document).on("keyup.danbooru.relatedTags","#upload_tag_string, #post_tag_string",f.update_selected),$(document).on("danbooru:open-post-edit-dialog",f.hide),$(document).on("danbooru:close-post-edit-dialog",f.show),$(document).on("danbooru:open-post-edit-tab",f.show),$(document).on("danbooru:open-post-edit-tab",f.init_post_show_editor)},tag_editor_setup:!1,init_post_show_editor:function(){if(!f.tag_editor_setup){f.tag_editor_setup=!0;var t=new o.Z({render:function(t){return t(p)}});t.$mount("#tag-string-editor"),setTimeout((function(){var e=t.$children[0].$refs.otherTags;e.style.height=e.scrollHeight+"px",e.focus(),e.scrollIntoView()}),20)}},on_click_related_tags_button:function(t){f.show()},current_tag:function(){var t=$("#upload_tag_string,#post_tag_string"),e=t.val(),a=e.length,n=t.prop("selectionStart"),i=t.prop("selectionStart");if(n>0&&n<a-1&&!/\s/.test(e[n])&&/\s/.test(e[n-1]))for(;i<a&&!/\s/.test(e[i]);)i++;else if(e.search(/\S/)>i)for(i=e.search(/\S/);i<a&&!/\s/.test(e[i]);)i++;else{for(;n>0&&(/\s/.test(e[n])||void 0===e[n]);)n--,i--;for(;n>0&&!/\s/.test(e[n-1]);)n--,i--;for(;i<a-1&&!/\s/.test(e[i]);)i++}return i++,e.slice(n,i)},update_selected:function(t){var e=$("#upload_tag_string,#post_tag_string").val().toLowerCase().match(/\S+/g)||[],a=$(".related-tags a.search-tag");a.removeClass("selected"),a.each((function(t,a){e.indexOf(a.textContent.replace(/ /g,"_"))>-1&&$(a).addClass("selected")}))},tags_include:function(t){var e=$("#upload_tag_string,#post_tag_string").val().toLowerCase().match(/\S+/g)||[];return $.inArray(t.toLowerCase(),e)>-1},toggle_tag:function(t){var e=$("#upload_tag_string,#post_tag_string"),a=$(t.target).html().replace(/ /g,"_").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");if(f.tags_include(a)){var o=n.default.regexp_escape(a);e.val(e.val().replace(new RegExp("(^|\\s)"+o+"($|\\s)","gi"),"$1$2"))}else e.val(e.val()+" "+a);e.val(e.val().trim().replace(/ +/g," ")+" "),f.update_selected(),setTimeout((function(){e.prop("selectionStart",e.val().length)}),100),t.preventDefault(),i.default.update_tag_count({target:e})},show:function(t){$(document).trigger("danbooru:show-related-tags"),$("#related-tags-container").removeClass("hidden").addClass("visible"),t&&t.preventDefault()},hide:function(t){$("#related-tags-container").removeClass("visible").addClass("hidden"),t&&t.preventDefault()}};$((function(){f.initialize_all()}));var g=f},2546:function(t,e,a){"use strict";a.r(e);var n={},i=["/images/notfound-preview.png","data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="],o="/images/notfound-preview.png",r="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";n.old_domain="",n.update_preview_file=function(t){var e=new FileReader;e.onload=function(t){n.set_preview_url(t.target.result)},e.readAsDataURL(t)},n.update_preview_url=function(){var t=$("#post_replacement_replacement_url").val();if(t){var e=n.isSampleURL(t);if(!1!==e)return $("#bad_upload_url_reason").text(e),void $("#bad_upload_url").show();$("#bad_upload_url").hide();var a=$("<a>").prop("href",t).prop("hostname");a&&a!==n.old_domain?$.getJSON("/upload_whitelists/is_allowed.json",{url:t},(function(t){t.domain&&(n.upload_allow_set(t.is_allowed,t.domain,t.reason),t.is_allowed||n.set_preview_url(r))})):a||n.upload_allow_clear(),n.old_domain=a,n.set_preview_url(t)}else n.upload_allow_clear()},n.update_preview_dims=function(){var t=$("#replacement_preview_img")[0];0===i.filter((function(e){return-1!==t.src.indexOf(e)})).length&&n.set_preview_dims(t.naturalHeight,t.naturalWidth)},n.preview_error=function(t){var e=t.target;n.set_preview_dims(-1,-1),0===i.filter((function(t){return-1!==e.src.indexOf(t)})).length&&n.set_preview_url(o)},n.set_preview_dims=function(t,e){t<=0&&e<=0?$("#replacement_preview_dims").text(""):$("#replacement_preview_dims").text("".concat(e,"x").concat(t))},n.set_preview_url=function(t){$("#replacement_preview_img").attr("src",t)},n.update_preview=function(){var t=$("#post_replacement_replacement_file")[0];t&&t.files[0]?n.update_preview_file(t.files[0]):n.update_preview_url()},n.update_preview_paste=function(){setTimeout(n.update_preview,150)},n.isSampleURL=function(t){for(var e=[{reason:"Thumbnail URL",test:/[at]\.facdn\.net/gi},{reason:"Sample URL",test:/pximg\.net\/img-master/gi},{reason:"Sample URL",test:/d3gz42uwgl1r1y\.cloudfront\.net\/.*\/\d+x\d+\./gi},{reason:"Sample URL",test:/pbs\.twimg\.com\/media\/[\w\-_]+\.(jpg|png)(:large)?$/gi},{reason:"Sample URL",test:/pbs\.twimg\.com\/media\/[\w\-_]+\?format=(jpg|png)(?!&name=orig)/gi},{reason:"Sample URL",test:/derpicdn\.net\/.*\/large\./gi},{reason:"Sample URL",test:/metapix\.net\/files\/(preview|screen)\//gi},{reason:"Sample URL",test:/sofurryfiles\.com\/std\/preview/gi}],a=0;a<e.length;++a){var n=e[a];if(n.test.test(t))return n.reason}return!1},n.upload_allow_clear=function(){$("#whitelist-warning").hide()},n.upload_allow_set=function(t,e,a){$("#whitelist-warning").removeClass().addClass(["whitelist-warning-disallowed","whitelist-warning-allowed"][t?1:0]),$("#whitelist-warning-domain").text(e),t?$("#whitelist-warning-not").hide():$("#whitelist-warning-not").show(),$("#whitelist-warning").show()},n.init_uploader=function(){$("#replacement_preview_img").on("load",n.update_preview_dims),$("#replacement_preview_img").on("error",n.preview_error),$("#post_replacement_replacement_url").on("keyup",n.update_preview),$("#post_replacement_replacement_file").on("change",n.update_preview),$("#post_replacement_replacement_url").on("paste",n.update_preview_paste)},$((function(){$("#c-post-replacements > #a-new").length&&n.init_uploader()})),e.default=n},5462:function(){$((function(){$("#maintoggle").on("click.danbooru",(function(t){t.preventDefault(),$("#nav").toggle(),$("#maintoggle-on").toggle(),$("#maintoggle-off").toggle()}))}))},9633:function(t,e,a){"use strict";function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}a.r(e),a.d(e,{SendQueue:function(){return o}});var i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.timeout=e||1e3,this.queue=[],this.id=null,this.running=!0}var e,a,i;return e=t,(a=[{key:"tick",value:function(){if(!this.running||!this.queue.length)return clearInterval(this.id),void(this.id=null);this.queue.shift()()}},{key:"add",value:function(t){this.queue.push(t),this.running&&this.start()}},{key:"start",value:function(){var t=this;this.running=!0,this.id||(this.id=setInterval((function(){t.tick()}),this.timeout),this.tick())}},{key:"stop",value:function(){this.id&&clearInterval(this.id),this.id=null,this.running=!1}}])&&n(e.prototype,a),i&&n(e,i),t}(),o=new i(700);e.default=i},8941:function(t,e,a){"use strict";a.r(e);var n=a(8505),i={initialize:function(){n.default.keydown("s","scroll_down",i.nav_scroll_down),n.default.keydown("w","scroll_up",i.nav_scroll_up),i.initialize_data_shortcuts()},initialize_data_shortcuts:function(){$(document).off("keydown.danbooru.shortcut"),$("[data-shortcut]").each((function(t,e){var a=$(e).attr("id"),i=$(e).attr("data-shortcut"),o="shortcut.".concat(a),r="Shortcut is ".concat(i.split(/\s+/).join(" or "));$(e).attr("title",r),n.default.keydown(i,o,(function(t){var e=$('[data-shortcut="'.concat(i,'"]')).get(0),a=$(e).attr("data-shortcut-when")||"*";$(e).is(a)&&($(e).is("input, textarea")?$(e).focus().selectEnd():e.click(),t.preventDefault())}))}))},nav_scroll_down:function(){window.scrollBy(0,.15*$(window).height())},nav_scroll_up:function(){window.scrollBy(0,-.15*$(window).height())}};$(document).ready((function(){i.initialize()})),e.default=i},5771:function(t,e,a){"use strict";a.r(e);var n=a(8505);function i(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,a,o;return e=t,o=[{key:"typePlural",value:function(t){return"alias"===t?"aliases":"".concat(t,"s")}},{key:"approve",value:function(t,e){t.preventDefault();var a=$(t.target).parents(".tag-".concat(e)),i=a.data("".concat(e,"-id"));$.ajax({url:"/tag_".concat(this.typePlural(e),"/").concat(i,"/approve.json"),type:"POST",dataType:"json"}).done((function(t){n.default.notice("Accepted ".concat(e,".")),a.slideUp("fast")})).fail((function(t){n.default.error("Failed to accept ".concat(e,"."))}))}},{key:"reject",value:function(t,e){t.preventDefault();var a=$(t.target).parents(".tag-".concat(e)),i=a.data("".concat(e,"-id"));confirm("Are you sure you want to reject this ".concat(e,"?"))&&$.ajax({url:"/tag_".concat(this.typePlural(e),"/").concat(i,".json"),type:"DELETE",dataType:"json"}).done((function(t){n.default.notice("Rejected ".concat(e,".")),a.slideUp("fast")})).fail((function(t){n.default.error("Failed to reject ".concat(e,"."))}))}}],(a=null)&&i(e.prototype,a),o&&i(e,o),t}();$(document).ready((function(){$(".tag-alias-accept").on("click",(function(t){o.approve(t,"alias")})),$(".tag-alias-reject").on("click",(function(t){o.reject(t,"alias")})),$(".tag-implication-accept").on("click",(function(t){o.approve(t,"implication")})),$(".tag-implication-reject").on("click",(function(t){o.reject(t,"implication")}))})),e.default=o},3966:function(t,e,a){"use strict";function n(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(!t)return;if("string"===typeof t)return i(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return i(t,e)}(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){l=!0,r=t},f:function(){try{s||null==a.return||a.return()}finally{if(l)throw r}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}a.r(e);var o={parse:function(t){return t.match(/\[.+?\]|\S+/g)},test:function(t,e){var a,i=n(e.match(/\S+/g));try{for(i.s();!(a=i.n()).done;){var o=a.value;if("-"===o[0]){if(t.has(o.substr(1)))return!1}else if(!t.has(o))return!1}}catch(r){i.e(r)}finally{i.f()}return!0},process:function(t,e){if(e.match(/^\[if/)){var a=e.match(/\[if\s+(.+?)\s*,\s*(.+?)\]/);return o.test(t,a[1])?o.process(t,a[2]):null}return"[reset]"===e?null:e},run:function(t,e){var a,i=[],r=n(o.parse(e));try{for(r.s();!(a=r.n()).done;){var s=a.value,l=o.process(t,s);null!==l&&i.push(l)}}catch(c){r.e(c)}finally{r.f()}return i.join(" ")}};e.default=o},5327:function(t,e,a){"use strict";a.r(e);var n=a(8505),i={destroy:function(t){n.default.notice("Deleting takedown #"+t+"..."),$.ajax({url:"/takedown/destroy.json",type:"POST",dataType:"json",headers:{accept:"text/javascript"},data:{id:t}}).done((function(e){n.default.notice("Takedown deleted"),$("#takedown-"+t).fadeOut("fast")})).fail((function(t){n.default.error(t.responseText)}))},add_posts_by_tags_preview:function(t){var e=$("#takedown-add-posts-tags").val();$.ajax({url:"/takedowns/count_matching_posts.json",type:"POST",dataType:"json",headers:{accept:"text/javascript"},data:{id:t,post_tags:e}}).done((function(t){var a=t.matched_post_count,n="<a href='/post/index?tags="+e.replace(" ","+")+"+status:any'>"+a+" "+(1==a?"post":"posts")+"</a> "+(1==a?"matches":"match")+" the search '<a href='/post/index?tags="+e.replace(" ","+")+"+status:any'>"+e+"</a>'. Click Confirm to add "+(1==a?"it":"them")+" to the takedown.";$("#takedown-add-posts-tags-warning").html(n).show(),$("#takedown-add-posts-tags").prop("disabled",!0),$("#takedown-add-posts-tags-preview").hide(),$("#takedown-add-posts-tags-confirm").show(),$("#takedown-add-posts-tags-cancel").show()})).fail((function(t){n.default.error(t.responseText)}))},add_posts_by_tags_cancel:function(){$("#takedown-add-posts-tags-warning").hide(),$("#takedown-add-posts-tags").val("").prop("disabled",!1),$("#takedown-add-posts-tags-preview").show().prop("disabled",!0),$("#takedown-add-posts-tags-confirm").hide(),$("#takedown-add-posts-tags-cancel").hide()},add_posts_by_tags:function(t){event.preventDefault();var e=$("#takedown-add-posts-tags").val();n.default.notice("Adding posts with tags '"+e+"' to takedown..."),$.ajax({url:"/takedowns/".concat(t,"/add_by_tags.json"),type:"POST",dataType:"json",headers:{accept:"text/javascript"},data:{id:t,post_tags:e}}).done((function(t){var a=t.added_post_ids,o=a.length;n.default.notice(o+" post"+(1==o?"":"s")+" with tags '"+e+"' added to takedown");for(var r=0;r<o;r++){var s=i.post_button_html(a[r]);$(s).appendTo($("#takedown-post-buttons"))}$("#takedown-add-posts-tags-submit").prop("disabled",!0),i.add_posts_by_tags_cancel()})).fail((function(t){n.default.error(t.responseText)}))},add_posts_by_ids:function(t){event.preventDefault();var e=$("#takedown-add-posts-ids").val();n.default.notice("Adding posts to takedown..."),$.ajax({url:"/takedowns/".concat(t,"/add_by_ids.json"),type:"POST",dataType:"json",headers:{accept:"text/javascript"},data:{id:t,post_ids:e}}).done((function(t){n.default.notice(t.added_count+" post"+(1==t.added_count?"":"s")+" added to takedown");for(var e=t.added_post_ids,a=0;a<e.length;a++){var o=i.post_button_html(e[a]);$(o).appendTo($("#takedown-post-buttons"))}$("#takedown-add-posts-ids").val(""),$("#takedown-add-posts-ids-submit").prop("disabled",!0)})).fail((function(t){n.default.error(t.responseText)}))},remove_post:function(t,e){n.default.notice("Removing post #"+e+" from takedown..."),$.ajax({url:"/takedowns/".concat(t,"/remove_by_ids.json"),type:"POST",dataType:"json",headers:{accept:"text/javascript"},data:{id:t,post_ids:e}}).done((function(t){n.default.notice("Post #"+e+" removed from takedown"),$("#takedown-post-"+e).remove()})).fail((function(t){n.default.error(t.responseText)}))},post_button_html:function(t){return"<div id='takedown-post-"+t+"' data-post-id='"+t+"' class='takedown-post'><div class='takedown-post-label takedown-post-remove' title='Remove this post from the takedown'>X</div> <label for='takedown_posts_"+t+"' class='takedown-post-label takedown-post-keep'><input name='takedown_posts["+t+"]' type='hidden' value='0'><input id='takedown_posts_"+t+"' name='takedown_posts["+t+"]' type='checkbox' value='1'> <span>Keep</span></label> <a href='/post/show/"+t+"'>post #"+t+"</a></div>"}};$(document).ready((function(){$("#takedown-add-posts-ids-submit").on("click",(function(t){var e=$(t.target);i.add_posts_by_ids(e.data("tid"))})),$("#takedown-add-posts-tags-cancel").on("click",(function(){i.add_posts_by_tags_cancel()})),$("#takedown-add-posts-tags-confirm").on("click",(function(t){var e=$(t.target);i.add_posts_by_tags(e.data("tid"))})),$("#takedown-add-posts-tags-preview").on("click",(function(t){var e=$(t.target);i.add_posts_by_tags_preview(e.data("tid"))}))})),e.default=i},2363:function(t,e,a){"use strict";a.r(e);var n=a(2666),i=a(5669),o={initialize:function(){var t=function(t){t.hasClass("thumb-placeholder-link")?t.removeClass("thumb-placeholder-link"):t.empty()},e=window.___deferred_posts||{},a=$(".post-thumb.placeholder, .thumb-placeholder-link"),o="1"===i.default.get("dab");$.each(a,(function(a,i){var r=$(i),s=r.data("id");if(s){var l=e[s];if(l){var c=0;$.each(n.default.entries,(function(t,e){n.default.postMatchObject(l,e)&&(e.hits+=1,c+=1)}));var d=$("<div>"),u=!o&&c>0;for(var p in l)d.attr("data-"+p.replace(/_/g,"-"),l[p]);d.attr("class",u?"post-thumbnail blacklisted blacklisted-active":"post-thumbnail"),r.hasClass("thumb-placeholder-link")&&d.addClass("dtext");var f=$("<img>");d.attr("data-orig-url",l.preview_url||"/images/deleted-preview.png"),u?f.attr("src","/images/blacklisted-preview.png"):f.attr("src",l.preview_url||"/images/deleted-preview.png"),f.attr({height:l.preview_url?l.preview_height:150,width:l.preview_url?l.preview_width:150,title:"Rating: ".concat(l.rating,"\r\nID: ").concat(l.id,"\r\nStatus: ").concat(l.status,"\r\nDate: ").concat(l.created_at,"\r\n\r\n").concat(l.tags),alt:l.tags,class:"post-thumbnail-img"});var g=$("<a>");g.attr("href","/posts/".concat(l.id)),g.append(f),d.append(g),r.replaceWith(d)}else t(r)}else t(r)}))}};$(document).ready((function(){o.initialize(),$(window).on("e621:add_deferred_posts",(function(t,e){window.___deferred_posts=window.___deferred_posts||{},window.___deferred_posts=$.extend(window.___deferred_posts,e),o.initialize()})),$(document).on("thumbnails:apply",o.initialize)})),e.default=o},3236:function(t,e,a){"use strict";a.r(e);var n=a(1995);a(9971),a(6227),a(6959),a(4301);var i={create_player:function(t,e,a){var o={mime_type:t,frames:e},r={canvas:$("#image")[0],source:a,metadata:o,chunkSize:3e5,loop:!0,autoStart:!0,debug:!1};i.player=new n.ZipImagePlayer(r),i.player_manually_paused=!1,$(i.player).on("loadProgress.danbooru",(function(t,e){$("#seek-slider").progressbar("value",Math.floor(100*e))})),$("#ugoira-play").on("click.danbooru",(function(t){i.player.play(),$("#ugoira-play").hide(),$("#ugoira-pause").show(),i.player_manually_paused=!1,t.preventDefault()})),$("#ugoira-pause").on("click.danbooru",(function(t){i.player.pause(),$("#ugoira-pause").hide(),$("#ugoira-play").show(),i.player_manually_paused=!0,t.preventDefault()})),$("#seek-slider").progressbar({value:0}),$("#seek-slider").slider({min:0,max:i.player._frameCount-1,start:function(t,e){i.player.pause()},slide:function(t,e){i.player._frame=e.value,i.player._displayFrame()},stop:function(t,e){i.player_manually_paused||i.player.play()}}),$(i.player).on("frame.danbooru",(function(t,e){$("#seek-slider").slider("option","value",e)}))}};e.default=i},9832:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return L}});var n=a(144),i={props:["value","index","last"],data:function(){return{backendValue:this.value}},computed:{realValue:{get:function(){return this.backendValue},set:function(t){this.backendValue=t,this.$emit("input",t)}}},methods:{add:function(){this.$emit("add")},remove:function(){this.$emit("delete")}},watch:{value:function(t){this.backendValue=t}}},o=a(1900),r=(0,o.Z)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"upload-source-row"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.realValue,expression:"realValue"}],attrs:{type:"text",size:"50"},domProps:{value:t.realValue},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.add.apply(null,arguments)},input:function(e){e.target.composing||(t.realValue=e.target.value)}}}),t._v(" "),0!==t.index?a("button",{on:{click:t.remove}},[t._v("-")]):t._e(),t._v(" "),t.last&&t.index<9?a("button",{on:{click:t.add}},[t._v("+")]):t._e()])}),[],!1,null,null,null),s=r.exports,l={props:["check","checks"],computed:{value:{get:function(){return void 0!==this.checks[this.tagName]&&this.checks[this.tagName]},set:function(t){this.$emit("set",this.tagName,t)}},tagName:function(){return this.check.tag||this.check.name.toLowerCase().replace(/ /g,"_")}}},c=(0,o.Z)(l,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("button",{staticClass:"toggle-button",class:{active:t.value},on:{click:function(e){t.value=!t.value}}},[t._v(t._s(t.check.name))])}),[],!1,null,null,null).exports,d=a(2453),u=a(3269),p={props:{classes:String,preview:Object},computed:{previewDimensions:function(){return this.preview.width&&this.preview.height?this.preview.width+"\xd7"+this.preview.height:""}}},f=(0,o.Z)(p,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"upload_preview_container",class:t.classes},[a("div",{staticClass:"upload_preview_dims"},[t._v(t._s(t.previewDimensions))]),t._v(" "),t.preview.isVideo?t._e():a("img",{staticClass:"upload_preview_img",staticStyle:{"max-width":"100%"},attrs:{src:t.preview.url,referrerpolicy:"no-referrer"},on:{load:function(e){return t.$emit("load",e)},error:function(e){return t.$emit("error")}}}),t._v(" "),t.preview.isVideo?a("video",{staticClass:"upload_preview_img",staticStyle:{"max-width":"100%"},attrs:{controls:"",src:t.preview.url},on:{loadeddata:function(e){return t.$emit("load",e)},error:function(e){return t.$emit("error")}}}):t._e()])}),[],!1,null,null,null).exports;function g(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||v(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=v(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return r=t.done,t},e:function(t){s=!0,o=t},f:function(){try{r||null==a.return||a.return()}finally{if(s)throw o}}}}function v(t,e){if(t){if("string"===typeof t)return m(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var _=["/images/notfound-preview.png","/images/download-preview.png","data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="],w="/images/download-preview.png",b="/images/notfound-preview.png",y="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",k=[{name:"Unknown Artist"},{name:"Anonymous Artist"}],x=[{name:"Male"},{name:"Female"},{name:"Andromorph"},{name:"Gynomorph"},{name:"Hermaphrodite",tag:"herm"},{name:"Male-Herm",tag:"maleherm"},{name:"Ambiguous",tag:"ambiguous_gender"}],j=[{name:"Male/Male"},{name:"Male/Female"},{name:"Female/Female"},{name:"Intersex/Male"},{name:"Intersex/Female"},{name:"Intersex/Intersex"}],T=[{name:"Solo"},{name:"Duo"},{name:"Group"},{name:"Zero Pictured"}],C=[{name:"Anthro"},{name:"Feral"},{name:"Humanoid"},{name:"Human"},{name:"Taur"}];function S(){var t=this,e=new FileReader,a=this.$refs.post_file.files[0];this.filePreview.height=0,this.filePreview.width=0,this.resetFilePreview(),e.onload=function(e){var n=e.target.result;a.type.match("video/webm")?t.setPreviewVideo(n):a.type.match("application/x-shockwave-flash")?t.setPreviewImage(w):t.setPreviewImage(n)},e.readAsDataURL(a),this.disableURLUpload=!0}function D(){var t=this;if(0===this.uploadURL.length||this.$refs.post_file&&this.$refs.post_file.files.length>0)return this.disableFileUpload=!1,this.oldDomain="",this.filePreview.width=0,this.filePreview.height=0,this.resetFilePreview(),void t.clearWhitelistWarning();this.disableFileUpload=!0;var e=$("<a>").prop("href",this.uploadURL).prop("hostname");e&&e!==this.oldDomain?$.getJSON("/upload_whitelists/is_allowed.json",{url:this.uploadURL},(function(e){e.domain&&(t.whitelistWarning(e.is_allowed,e.domain,e.reason),e.is_allowed||t.setPreviewImage(y))})):e||t.clearWhitelistWarning(),this.oldDomain=e,this.uploadURL.match(/^(https?\:\/\/|www).*?\.(swf)$/)?this.setPreviewImage(w):this.uploadURL.match(/^(https?\:\/\/|www).*?\.(webm)$/)?this.setPreviewVideo(this.uploadURL):this.uploadURL.match(/^(https?\:\/\/|www).*?$/)?this.setPreviewImage(this.uploadURL):this.setPreviewImage(y)}function A(t,e){return t[0]>e[0]?1:-1}function E(){if(!this.allowNavigate){var t=this.$refs.post_file;return!!(t&&t.files&&t.files.length||this.uploadURL)||void 0}}var P={components:{"image-source":s,"image-checkbox":c,"related-tags":d.Z,"tag-preview":u.Z,"file-preview":f},data:function(){var t={},e=function(e){"undefined"===typeof e.tag?t[e.name.toLowerCase().replace(" ","_")]=!0:t[e.tag]=!0};return k.forEach(e),x.forEach(e),j.forEach(e),T.forEach(e),C.forEach(e),{safe:window.uploaderSettings.safeSite,showErrors:!1,whitelist:{visible:!1,allowed:!1,domain:""},allowNavigate:!1,submitting:!1,disableFileUpload:!1,disableURLUpload:!1,filePreview:{heigth:0,width:0,overDims:!1,url:y,isVideo:!1},uploadURL:"",oldDomain:"",noSource:!1,sources:[""],normalMode:!window.uploaderSettings.compactMode,checkboxes:{artist:k,sex:x,pairing:j,count:T,body:C,selected:{},all:t},tagEntries:{character:"",sex:"",bodyType:"",theme:"",other:""},tagPreview:{loading:!1,show:!1,tags:[]},allowLockedTags:window.uploaderSettings.allowLockedTags,lockedTags:"",allowRatingLock:window.uploaderSettings.allowRatingLock,ratingLocked:!1,relatedTags:[],loadingRelated:!1,parentID:"",description:"",rating:"",error:"",duplicateId:0,descrLimit:window.uploaderSettings.descrLimit}},mounted:function(){var t=this;window.onbeforeunload=E.bind(t);var e,a,n=new URLSearchParams(window.location.search),i=function(e,a){n.has(a)&&(t[e]=n.get(a))};i("uploadURL","upload_url"),n.has("upload_url")&&this.updateFilePreview(),i("parentID","parent"),i("description","description"),function(){if(n.has("tags")){var e,a=h(n.get("tags").split(" "));try{for(a.s();!(e=a.n()).done;){var i=e.value.trim();i&&t.pushTag(i,!0)}}catch(o){a.e(o)}finally{a.f()}}}(),n.has("sources")&&(t.sources=n.get("sources").split(",")),this.allowRatingLock&&(e="ratingLocked",a="rating_locked",n.has(a)&&(t[e]="true"===n.get(a))),this.allowLockedTags&&i("lockedTags","locked_tags")},methods:{updateFilePreview:function(){this.$refs.post_file&&this.$refs.post_file.files[0]?S.call(this):D.call(this)},updateFilePreviewOnPaste:function(t){this.uploadURL=(event.clipboardData||window.clipboardData).getData("text"),this.updateFilePreview(),t.preventDefault()},updateFilePreviewDims:function(t){var e=t.target;0===_.filter((function(t){return-1!==e.src.indexOf(t)})).length&&(this.filePreview.height=e.naturalHeight||e.videoHeight,this.filePreview.width=e.naturalWidth||e.videoWidth,this.filePreview.overDims=this.filePreview.height>15e3||this.filePreview.width>15e3)},setPreviewImage:function(t){this.filePreview.isVideo=!1,this.filePreview.url=t},setPreviewVideo:function(t){this.filePreview.isVideo=!0,this.filePreview.url=t},resetFilePreview:function(){this.filePreview.isVideo=!1,this.filePreview.url=y,this.filePreview.overDims=!1},filePreviewError:function(){this.filePreview.width=this.filePreview.height=0,this.filePreview.overDims=!1,""!==this.uploadURL||this.$refs.post_file?this.setPreviewImage(b):this.setPreviewImage(y)},clearFile:function(){this.$refs.post_file&&this.$refs.post_file.files[0]&&(this.$refs.post_file.value=null,this.disableURLUpload=this.disableFileUpload=!1,this.resetFilePreview(),this.updateFilePreview())},whitelistWarning:function(t,e,a){this.whitelist.allowed=t,this.whitelist.domain=e,this.whitelist.reason=a,this.whitelist.visible=!0},clearWhitelistWarning:function(){this.whitelist.visible=!1,this.whitelist.domain=""},removeSource:function(t){this.sources.splice(t,1)},addSource:function(){this.sources.length<10&&this.sources.push("")},setCheck:function(t,e){n.Z.set(this.checkboxes.selected,t,e)},toggleNormalMode:function(){this.normalMode=!this.normalMode;var t=Object.keys(this.tagEntries);if(this.normalMode){var e=new Set(this.tagEntries.other.toLowerCase().trim().split(" ").filter((function(t){return t.trim()})));for(var a in this.checkboxes.all)e.has(a)&&(this.setCheck(a,!0),e.delete(a));for(var i=0,o=["character","sex","bodyType","theme"];i<o.length;i++){var r,s=o[i],l=h(new Set(this.tagEntries[s].toLowerCase().trim().split(" ").filter((function(t){return t.trim()}))));try{for(l.s();!(r=l.n()).done;){var c=r.value;e.has(c)&&e.delete(c)}}catch(v){l.e(v)}finally{l.f()}}this.tagEntries.other=g(e).sort().join(" ")}else{var d,u=Object.entries(this.checkboxes.selected).filter((function(t){return!0===t[1]})).map((function(t){return t[0]})),p=h(t);try{for(p.s();!(d=p.n()).done;){var f=d.value;u.push.apply(u,g(this.tagEntries[f].toLowerCase().trim().split(" ").filter((function(t){return t.trim()}))))}}catch(v){p.e(v)}finally{p.f()}this.tagEntries.other=g(new Set(u)).sort().join(" "),n.Z.set(this.checkboxes,"selected",{})}},submit:function(){if(this.showErrors=!0,this.error="",!this.preventUpload&&!this.submitting){var t=this;this.submitting=!0;var e=new FormData,a=this.$refs.post_file;a&&a.files&&a.files.length?e.append("upload[file]",this.$refs.post_file.files[0]):e.append("upload[direct_url]",this.uploadURL),e.append("upload[tag_string]",this.tags),e.append("upload[rating]",this.rating),e.append("upload[source]",this.sources.join("\n")),e.append("upload[description]",this.description),e.append("upload[parent_id]",this.parentID),this.allowLockedTags&&e.append("upload[locked_tags]",this.lockedTags),this.allowRatingLock&&e.append("upload[locked_rating]",this.ratingLocked),jQuery.ajax("/uploads.json",{contentType:!1,processData:!1,method:"POST",type:"POST",data:e,success:function(e){t.submitting=!1,t.allowNavigate=!0,Danbooru.notice("Post uploaded successfully."),location.assign(e.location)},error:function(e){t.submitting=!1;var a=e.responseJSON;try{a&&"duplicate"===a.reason&&(t.duplicateId=a.post_id),a&&-1!==["duplicate","invalid"].indexOf(a.reason)?t.error=a.message:a&&a.message?t.error="Error: "+a.message:t.error="Error: "+a.reason}catch(n){t.error="Error: Unknown error! "+JSON.stringify(a)}}})}},pushTag:function(t,e){if(this.tagPreview.show=!1,"undefined"!==typeof this.checkboxes.all[t]&&this.normalMode)this.setCheck(t,e);else{var a=this.tagEntries.other?this.tagEntries.other.trim().split(" "):[],n=a.indexOf(t);if(e)-1===n&&a.push(t);else{if(-1===n)return;a.splice(n,1)}this.tagEntries.other=a.join(" ")+" "}},previewFinalTags:function(){if(!this.tagPreview.loading)if(this.tagPreview.show)this.tagPreview.show=!1;else{this.tagPreview.loading=!0,this.tagPreview.show=!0,this.tagPreview.tags=[];var t=this,e={tags:this.tags};jQuery.ajax("/tags/preview.json",{method:"POST",type:"POST",data:e,success:function(e){t.tagPreview.loading=!1,t.tagPreview.tags=e},error:function(e){t.tagPreview.loading=!1,t.tagPreview.tags=[],t.tagPreview.show=!1,Danbooru.error("Error loading tag preview "+e)}})}},findRelated:function(t){var e=this;if(!e.loadingRelated)if(e.relatedTags.length>0&&e.lastRelatedType===t)e.relatedTags=[];else{this.loadingRelated=!0,this.relatedTags=[];var a=function(){var t=e.$refs.otherTags;if(!t.hasOwnProperty("selectionStart"))return null;var a=t.selectionEnd-t.selectionStart;return a?t.value.substr(t.selectionStart,a):null}(),n=a?{query:a}:{query:this.tags};t&&(n.category=t),$.getJSON("/related_tag/bulk.json",n,(function(a){e.relatedTags=function(t){var e=[];for(var a in t)t.hasOwnProperty(a)&&t[a].length&&e.push({title:"Related: "+a,tags:t[a].sort(A)});return e}(a),e.lastRelatedType=t})).always((function(){e.loadingRelated=!1}))}}},computed:{tags:function(){var t=this;return this.normalMode?Object.keys(this.checkboxes.selected).filter((function(e){return!0===t.checkboxes.selected[e]})).concat([this.tagEntries.other,this.tagEntries.sex,this.tagEntries.bodyType,this.tagEntries.theme,this.tagEntries.character]).join(" ").replace(","," ").trim().replace(/ +/g," "):this.tagEntries.other},tagsArray:function(){return this.tags.toLowerCase().split(" ")},directURLProblem:function(){return function(t){for(var e=[{reason:"Thumbnail URL",test:/[at]\.facdn\.net/gi},{reason:"Sample URL",test:/pximg\.net\/img-master/gi},{reason:"Sample URL",test:/d3gz42uwgl1r1y\.cloudfront\.net\/.*\/\d+x\d+\./gi},{reason:"Sample URL",test:/pbs\.twimg\.com\/media\/[\w\-_]+\.(jpg|png)(:large)?$/gi},{reason:"Sample URL",test:/pbs\.twimg\.com\/media\/[\w\-_]+\?format=(jpg|png)(?!&name=orig)/gi},{reason:"Sample URL",test:/derpicdn\.net\/.*\/large\./gi},{reason:"Sample URL",test:/metapix\.net\/files\/(preview|screen)\//gi},{reason:"Sample URL",test:/sofurryfiles\.com\/std\/preview/gi}],a=0;a<e.length;++a){var n=e[a];if(n.test.test(t))return n.reason}return""}(this.uploadURL)},badDirectURL:function(){return!!this.directURLProblem},sourceWarning:function(){var t=this.sources.filter((function(t){return t.length>0})).length;return!this.noSource&&0===t},tagCount:function(){return this.tags.split(" ").filter((function(t){return t})).length},notEnoughTags:function(){return this.tagCount<4},invalidRating:function(){return!this.rating},preventUpload:function(){return this.sourceWarning||this.badDirectURL||this.notEnoughTags||this.invalidRating},duplicatePath:function(){return"/posts/".concat(this.duplicateId)}}},z=(0,o.Z)(P,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flex-grid-outer"},[a("div",{staticClass:"col box-section",staticStyle:{flex:"2 0 0"}},[a("div",{staticClass:"the_secret_switch",on:{click:t.toggleNormalMode}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.filePreview.overDims,expression:"filePreview.overDims"}],staticClass:"box-section sect_red"},[t._v("\n            One of the image dimensions is above the maximum allowed of 15,000px and will fail to upload.\n        ")]),t._v(" "),a("div",{staticClass:"flex-grid border-bottom"},[t._m(0),t._v(" "),a("div",{staticClass:"col2"},[t.disableFileUpload?t._e():a("div",[a("label",[t._v("File:\n                        "),a("input",{ref:"post_file",attrs:{type:"file",accept:"image/png,image/apng,image/jpeg,image/gif,video/webm,.png,.apng,.jpg,.jpeg,.gif,.webm",disabled:t.disableFileUpload},on:{change:t.updateFilePreview,keyup:t.updateFilePreview}})]),t._v(" "),a("button",{directives:[{name:"show",rawName:"v-show",value:t.disableURLUpload,expression:"disableURLUpload"}],on:{click:t.clearFile}},[t._v("Clear")])]),t._v(" "),t.disableURLUpload?t._e():a("div",[t.badDirectURL?a("div",{staticClass:"box-section sect_red"},[t._v("\n                        The direct URL entered has the following problem: "+t._s(t.directURLProblem)),a("br"),t._v("\n                        You should review "),a("a",{attrs:{href:"/wiki_pages/howto:sites_and_sources"}},[t._v("the sourcing guide")]),t._v(".\n                    ")]):t._e(),t._v(" "),a("label",[t._v(t._s(t.disableFileUpload?"":"(or) ")+"URL:\n                        "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.uploadURL,expression:"uploadURL"}],attrs:{type:"text",size:"50",disabled:t.disableURLUpload},domProps:{value:t.uploadURL},on:{keyup:t.updateFilePreview,paste:function(e){return t.updateFilePreviewOnPaste(e)},input:function(e){e.target.composing||(t.uploadURL=e.target.value)}}})]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.whitelist.visible,expression:"whitelist.visible"}],class:{"whitelist-warning-allowed":t.whitelist.allowed,"whitelist-warning-disallowed":!t.whitelist.allowed},attrs:{id:"whitelist-warning"}},[t.whitelist.allowed?a("span",[t._v("Uploads from "),a("b",[t._v(t._s(t.whitelist.domain))]),t._v(" are permitted.")]):t._e(),t._v(" "),t.whitelist.allowed?t._e():a("span",[t._v("Uploads from "),a("b",[t._v(t._s(t.whitelist.domain))]),t._v(" are not permitted.\n                            "),t.whitelist.reason?a("span",[t._v("Reason given: "+t._s(t.whitelist.reason))]):t._e(),t._v("\n                            ("),a("a",{attrs:{href:"/upload_whitelists"}},[t._v("View whitelisted domains")]),t._v(")")])])])])]),t._v(" "),a("file-preview",{attrs:{classes:"box-section in-editor below-upload",preview:t.filePreview}}),t._v(" "),a("div",{staticClass:"flex-grid border-bottom"},[t._m(1),t._v(" "),a("div",{staticClass:"col2"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showErrors&&t.sourceWarning,expression:"showErrors && sourceWarning"}],staticClass:"box-section sect_red"},[t._v("\n                    A source must be provided or you must select that there is no available source.\n                ")]),t._v(" "),t.noSource?t._e():a("div",t._l(t.sources,(function(e,n){return a("image-source",{key:n,attrs:{last:n===t.sources.length-1,index:n},on:{delete:function(e){return t.removeSource(n)},add:t.addSource},model:{value:t.sources[n],callback:function(e){t.$set(t.sources,n,e)},expression:"sources[i]"}})})),1),t._v(" "),a("div",[a("label",{staticClass:"section-label"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.noSource,expression:"noSource"}],attrs:{type:"checkbox",id:"no_source"},domProps:{checked:Array.isArray(t.noSource)?t._i(t.noSource,null)>-1:t.noSource},on:{change:function(e){var a=t.noSource,n=e.target,i=!!n.checked;if(Array.isArray(a)){var o=t._i(a,null);n.checked?o<0&&(t.noSource=a.concat([null])):o>-1&&(t.noSource=a.slice(0,o).concat(a.slice(o+1)))}else t.noSource=i}}}),t._v("\n                        No available source / I am the source.\n                    ")])])])]),t._v(" "),t.normalMode?[a("div",{staticClass:"flex-grid border-bottom"},[t._m(2),t._v(" "),a("div",{staticClass:"col2"},[a("div",[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.tagEntries.character,expression:"tagEntries.character"}],staticClass:"tag-textarea",attrs:{id:"post_characters",rows:"2",placeholder:"Ex: artist_name etc.","data-autocomplete":"tag-edit"},domProps:{value:t.tagEntries.character},on:{input:function(e){e.target.composing||t.$set(t.tagEntries,"character",e.target.value)}}})]),t._v(" "),a("div",{staticClass:"flex-wrap"},t._l(t.checkboxes.artist,(function(e){return a("image-checkbox",{key:e.name,attrs:{check:e,checks:t.checkboxes.selected},on:{set:t.setCheck}})})),1)])]),t._v(" "),a("div",{staticClass:"flex-grid border-bottom"},[t._m(3),t._v(" "),a("div",{staticClass:"col2"},[a("div",{staticClass:"flex-wrap"},t._l(t.checkboxes.sex,(function(e){return a("image-checkbox",{key:e.name,attrs:{check:e,checks:t.checkboxes.selected},on:{set:t.setCheck}})})),1),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"flex-wrap"},t._l(t.checkboxes.count,(function(e){return a("image-checkbox",{key:e.name,attrs:{check:e,checks:t.checkboxes.selected},on:{set:t.setCheck}})})),1),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"flex-wrap"},t._l(t.checkboxes.pairing,(function(e){return a("image-checkbox",{key:e.name,attrs:{check:e,checks:t.checkboxes.selected},on:{set:t.setCheck}})})),1),t._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.tagEntries.sex,expression:"tagEntries.sex"}],staticClass:"tag-textarea",attrs:{rows:"2",id:"post_sexes",placeholder:"Ex: character_name solo_focus etc.","data-autocomplete":"tag-edit"},domProps:{value:t.tagEntries.sex},on:{input:function(e){e.target.composing||t.$set(t.tagEntries,"sex",e.target.value)}}})])]),t._v(" "),a("div",{staticClass:"flex-grid border-bottom"},[t._m(4),t._v(" "),a("div",{staticClass:"col2"},[a("div",{staticClass:"flex-wrap"},t._l(t.checkboxes.body,(function(e){return a("image-checkbox",{key:e.name,attrs:{check:e,checks:t.checkboxes.selected},on:{set:t.setCheck}})})),1),t._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.tagEntries.bodyType,expression:"tagEntries.bodyType"}],staticClass:"tag-textarea",attrs:{rows:"2",id:"post_bodyTypes",placeholder:"Ex: bear dragon hyena rat newt etc.","data-autocomplete":"tag-edit"},domProps:{value:t.tagEntries.bodyType},on:{input:function(e){e.target.composing||t.$set(t.tagEntries,"bodyType",e.target.value)}}})])]),t._v(" "),a("div",{staticClass:"flex-grid border-bottom"},[t._m(5),t._v(" "),a("div",{staticClass:"col2"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.tagEntries.theme,expression:"tagEntries.theme"}],staticClass:"tag-textarea",attrs:{id:"post_themes",rows:"2","data-autocomplete":"tag-edit",placeholder:"Ex: cub young gore scat watersports diaper my_little_pony vore not_furry rape hyper etc."},domProps:{value:t.tagEntries.theme},on:{input:function(e){e.target.composing||t.$set(t.tagEntries,"theme",e.target.value)}}})])])]:t._e(),t._v(" "),a("div",{staticClass:"flex-grid border-bottom"},[t._m(6),t._v(" "),a("div",{staticClass:"col2"},[t.showErrors&&t.invalidRating?a("div",{staticClass:"box-section sect_red"},[t._v("\n                    You must select an appropriate rating for this image.\n                ")]):t._e(),t._v(" "),a("div",[t.safe?t._e():[a("button",{staticClass:"toggle-button rating-e",class:{active:"e"===t.rating},on:{click:function(e){t.rating="e"}}},[t._v("\n                            Explicit\n                        ")]),t._v(" "),a("button",{staticClass:"toggle-button rating-q",class:{active:"q"===t.rating},on:{click:function(e){t.rating="q"}}},[t._v("\n                            Questionable\n                        ")])],t._v(" "),a("button",{staticClass:"toggle-button rating-s",class:{active:"s"===t.rating},on:{click:function(e){t.rating="s"}}},[t._v("Safe\n                    ")])],2)])]),t._v(" "),a("div",{staticClass:"flex-grid come-together-now"},[t._m(7),t._v(" "),a("div",{staticClass:"col2"},[a("file-preview",{attrs:{classes:"box-section in-editor",preview:t.filePreview}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showErrors&&t.notEnoughTags,expression:"showErrors && notEnoughTags"}],staticClass:"box-section sect_red"},[t._v("\n                    You must provide at least "),a("b",[t._v(t._s(4-t.tagCount))]),t._v(" more tags. Tags in other sections count\n                    towards this total.\n                ")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.tagPreview.show,expression:"!tagPreview.show"}]},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.tagEntries.other,expression:"tagEntries.other"}],ref:"otherTags",staticClass:"tag-textarea",attrs:{id:"post_tags",rows:"5","data-autocomplete":"tag-edit"},domProps:{value:t.tagEntries.other},on:{input:function(e){e.target.composing||t.$set(t.tagEntries,"other",e.target.value)}}})]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.tagPreview.show,expression:"tagPreview.show"}]},[a("tag-preview",{attrs:{tags:t.tagPreview.tags,loading:t.tagPreview.loading},on:{close:t.previewFinalTags}})],1),t._v(" "),a("div",{staticClass:"related-tag-functions"},[t._v("\n                    Related:\n                    "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated()}}},[t._v("Tags")]),t._v(" |\n                    "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated("artist")}}},[t._v("Artists")]),t._v(" |\n                    "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated("copyright")}}},[t._v("Copyrights")]),t._v(" |\n                    "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated("char")}}},[t._v("Characters")]),t._v(" |\n                    "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated("species")}}},[t._v("Species")]),t._v(" |\n                    "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.findRelated("meta")}}},[t._v("Metatags")]),t._v(" |\n                    "),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.previewFinalTags.apply(null,arguments)}}},[t._v("Preview Final Tags")])])],1)]),t._v(" "),a("div",{staticClass:"flex-grid border-bottom over-me"},[t.relatedTags.length?a("related-tags",{attrs:{tags:t.tagsArray,related:t.relatedTags,loading:t.loadingRelated},on:{"tag-active":t.pushTag}}):t._e()],1),t._v(" "),a("div",{staticClass:"flex-grid border-bottom"},[t._m(8),t._v(" "),a("div",{staticClass:"col2"},[a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.parentID,expression:"parentID",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Ex. 12345"},domProps:{value:t.parentID},on:{input:function(e){e.target.composing||(t.parentID=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])]),t._v(" "),t.allowLockedTags?a("div",{staticClass:"flex-grid border-bottom"},[t._m(9),t._v(" "),a("div",{staticClass:"col2"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.lockedTags,expression:"lockedTags"}],attrs:{type:"text","data-autocomplete":"tag-query"},domProps:{value:t.lockedTags},on:{input:function(e){e.target.composing||(t.lockedTags=e.target.value)}}})])]):t._e(),t._v(" "),t.allowRatingLock?a("div",{staticClass:"flex-grid border-bottom"},[t._m(10),t._v(" "),a("div",{staticClass:"col2"},[a("label",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.ratingLocked,expression:"ratingLocked"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.ratingLocked)?t._i(t.ratingLocked,null)>-1:t.ratingLocked},on:{change:function(e){var a=t.ratingLocked,n=e.target,i=!!n.checked;if(Array.isArray(a)){var o=t._i(a,null);n.checked?o<0&&(t.ratingLocked=a.concat([null])):o>-1&&(t.ratingLocked=a.slice(0,o).concat(a.slice(o+1)))}else t.ratingLocked=i}}}),t._v(" Lock Rating")])])]):t._e(),t._v(" "),a("div",{staticClass:"flex-grid border-bottom"},[t._m(11),t._v(" "),a("div",{staticClass:"col2"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"tag-textarea dtext-previewable",attrs:{id:"post_description",rows:"10","data-limit":t.descrLimit},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})])]),t._v(" "),a("div",{staticClass:"flex-grid"},[a("div",{staticClass:"col"}),t._v(" "),a("div",{staticClass:"col2"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.preventUpload&&t.showErrors,expression:"preventUpload && showErrors"}],staticClass:"box-section sect_red"},[t._v("\n                    Unmet requirements above prevent the submission of the post.\n                ")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.submitting,expression:"submitting"}],staticClass:"box-section sect_green"},[t._v("\n                    Submitting your post, please wait.\n                ")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"box-section sect_red"},[t._v("\n                    "+t._s(t.error)+"\n                ")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.duplicateId,expression:"duplicateId"}],staticClass:"box-section sect_red"},[t._v("\n                    Post is a duplicate of "),a("a",{attrs:{href:t.duplicatePath}},[t._v("post #"+t._s(t.duplicateId)+".")])]),t._v(" "),a("button",{attrs:{disabled:t.showErrors&&t.preventUpload||t.submitting,accesskey:"s"},on:{click:t.submit}},[t._v("\n                    "+t._s(t.submitting?"Uploading...":"Upload")+"\n                ")])])])],2),t._v(" "),a("div",{staticClass:"col box-section",staticStyle:{"margin-left":"10px",padding:"10px"},attrs:{id:"preview-sidebar"}},[a("file-preview",{attrs:{classes:"in-sidebar",preview:t.filePreview},on:{load:t.updateFilePreviewDims,error:t.filePreviewError}})],1)])}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label",attrs:{for:"post_file"}},[t._v("File")]),t._v(" "),a("div",{staticClass:"hint"},[a("a",{attrs:{href:"/help/supported_filetypes"}},[t._v("Supported Formats")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label",attrs:{for:"post_sources"}},[t._v("Sources")]),t._v(" "),a("div",[t._v("You should include: A link to the artists page where this was obtained, and a link to the\n                    submission page where this image was obtained. No available source should ONLY be used if the\n                    content has never been posted online anywhere else.\n                ")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label",attrs:{for:"names"}},[t._v("Artists")]),t._v(" "),a("div",[a("a",{attrs:{href:"/forum_topics/23553"}},[t._v("How do I tag an artist?")])]),t._v(" "),a("div",[t._v("Please don't use "),a("a",{attrs:{href:"/wiki_pages/anonymous_artist"}},[t._v("anonymous_artist")]),t._v(" or "),a("a",{attrs:{href:"/wiki_pages/unknown_artist"}},[t._v("unknown_artist")]),t._v(" tags unless they fall under those definitions on the wiki.")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label",attrs:{for:"post_sex_tags"}},[t._v("Characters")]),t._v(" "),a("div",[t._v("\n                        Select (and write in) all that apply. Character sex is based only on what is visible in the\n                        image.\n                    ")]),t._v(" "),a("div",[a("a",{attrs:{href:"/wiki_pages/tag_what_you_see"}},[t._v("\n                        Outside information or other images should not be used when deciding what tags are used.\n                    ")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label"},[t._v("Body Types and Species")]),t._v(" "),a("div",[t._v("One listed body type per visible character, listed options are mutually exclusive.")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label"},[t._v("Contentious Content")]),t._v(" "),a("div",[t._v("\n                        Fetishes or subjects that other users may find extreme or objectionable.\n                        These allow users to find or blacklist content with ease. Make sure that you are tagging\n                        these upon initial upload.\n                    ")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label"},[t._v("Rating")]),t._v(" "),a("div",[t._v("Explicit tags include sex, pussy, penis, masturbation, fellatio, etc.\n                    ("),a("a",{attrs:{href:"/help/ratings",target:"_blank"}},[t._v("help")]),t._v(")\n                ")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label",attrs:{for:"post_tags"}},[t._v("Other Tags")]),t._v(" "),a("div",[t._v("\n                    Separate tags with spaces. ("),a("a",{attrs:{href:"/help/tags",target:"_blank"}},[t._v("help")]),t._v(")\n                ")]),t._v(" "),a("div",[a("a",{attrs:{href:"/wiki_pages/tag_what_you_see"}},[t._v("\n                    Outside information or other images should not be used when deciding what tags are used.\n                  ")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label"},[t._v("Parent Post ID")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label"},[t._v("Locked Tags")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label"},[t._v("Lock Rating")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col"},[a("label",{staticClass:"section-label",attrs:{for:"post_description"}},[t._v("Description")])])}],!1,null,null,null),R=z.exports,L={init:function(){new n.Z({render:function(t){return t(R)}}).$mount("#uploader")}}},4821:function(t,e,a){"use strict";a.r(e);var n=a(3263),i={initialize_all:function(){$("#c-uploads,#c-posts").length&&($("#upload_direct_url").on("change.danbooru",i.fetch_data_manual),$(document).on("click.danbooru","#fetch-data-manual",i.fetch_data_manual)),$("#c-uploads").length&&($("#image").prop("complete")?this.initialize_image():($("#image").on("error.danbooru",(function(t){$("#upload-image").hide(),$("#scale-link").hide(),$("#iqdb-similar").hide()})),$("#image").on("load.danbooru",this.initialize_image)),this.initialize_similar(),this.initialize_submit(),$("#toggle-artist-commentary").on("click.danbooru",(function(t){i.toggle_commentary(),t.preventDefault()}))),$("#iqdb-similar").length&&this.initialize_iqdb_source()},initialize_submit:function(){$("#form").on("submit.danbooru",i.validate_upload)},validate_upload:function(t){var e=[];""!==$("#upload_file").val()||/^https?:\/\//i.test($("#upload_direct_url").val())||""!==$("#upload_md5_confirmation").val()||e.push("Must choose file or specify source"),!$("#upload_rating_s").prop("checked")&&!$("#upload_rating_q").prop("checked")&&!$("#upload_rating_e").prop("checked")&&$("#upload_tag_string").val().search(/\brating:[sqe]/i)<0&&e.push("Must specify a rating"),0===e.length?($("#submit-button").prop("disabled","true"),$("#submit-button").prop("value","Submitting..."),$("#client-errors").hide()):($("#client-errors").html("<strong>Error</strong>: "+e.join(", ")),$("#client-errors").show(),t.preventDefault())},initialize_iqdb_source:function(){/^https?:\/\//.test($("#upload_direct_url").val())&&$.get("/iqdb_queries",{url:$("#upload_direct_url").val()}).done((function(t){$("#iqdb-similar").html(t)}))},initialize_similar:function(){$("#similar-button").on("click.danbooru",(function(t){$.get("/iqdb_queries",{url:$("#upload_direct_url").val()}).done((function(t){$("#iqdb-similar").html(t).show()})),t.preventDefault()}))},update_scale:function(){var t=$("#image"),e=t.data("scale-factor");e<1?$("#scale").html("Scaled "+parseInt(100*e)+"% (original: "+t.data("original-width")+"x"+t.data("original-height")+")"):$("#scale").html("Original: "+t.data("original-width")+"x"+t.data("original-height"))},showWhitelistWarning:function(t,e,a){t?($("#whitelist-warning").addClass("whitelist-warning-allowed").removeClass("whitelist-warning-disallowed"),$("#whitelist-warning").html("Uploads from <span style='font-weight:bold'>"+a+"</span> are permitted!")):($("#whitelist-warning").removeClass("whitelist-warning-allowed").addClass("whitelist-warning-disallowed"),$("#whitelist-warning").html("Uploads from <span style='font-weight:bold'>"+a+"</span> are not permitted: "+e+" (<a href='/upload_whitelists'>View whitelisted domains</a>)")),$("#whitelist-warning").show()},fetch_data_manual:function(t){var e=$("#upload_direct_url").val(),a=$("#upload_referer_url").val();e.length||$("#whitelist-warning").hide(),/^https?:\/\//.test(e)&&($("#source-info").addClass("loading"),$.get("/source.js",{url:e,ref:a}).always((function(t){return $("#source-info").removeClass("loading")})),$.get("/upload_whitelists/is_allowed.json",{url:e}).always((function(t){i.showWhitelistWarning(t.is_allowed,t.reason,t.domain)}))),t.preventDefault()},initialize_image:function(){var t=$("#image");if(t.length){var e=t.width(),a=t.height();e&&a&&($("#no-image-available").hide(),t.data("original-width",e),t.data("original-height",a),n.default.resize_image_to_window(t),n.default.initialize_post_image_resize_to_window_link(),i.update_scale(),$("#image-resize-to-window-link").on("click.danbooru",i.update_scale))}},toggle_commentary:function(){$(".artist-commentary").is(":visible")?$("#toggle-artist-commentary").text("show \xbb"):$("#toggle-artist-commentary").text("\xab hide"),$(".artist-commentary").slideToggle()}};$((function(){i.initialize_all()})),e.default=i},3226:function(){$((function(){$("#c-user-feedbacks #negative-policy").hide(),$("#c-user-feedbacks #user_feedback_category").on("change.danbooru",(function(t){"negative"===t.target.value?$("#c-user-feedbacks #negative-policy").show():$("#c-user-feedbacks #negative-policy").hide()}))}))},7540:function(t,e,a){"use strict";a.r(e);var n=a(8505);$((function(){$(".item-mark-user-warned").on("click",(function(t){t.preventDefault();var e=$(t.target),a=e.data("item-type"),i=e.data("item-id"),o=e.data("record-type");$.ajax({type:"POST",url:"/".concat(a,"s/").concat(i,"/warning.json"),data:{record_type:o}}).done((function(t){location.reload()})).fail((function(t){n.default.error("Failed to mark as warned.")}))}))}))},8505:function(t,e,a){"use strict";a.r(e);var n={delay:function(t){return new Promise((function(e){return setTimeout(e,t)}))},meta:function(t){return $("meta[name="+t+"]").attr("content")},test_max_width:function(t){return!!window.matchMedia&&window.matchMedia("(max-width: "+t+"px)").matches},notice_timeout_id:void 0,notice:function(t,e){$("#notice").addClass("ui-state-highlight").removeClass("ui-state-error").fadeIn("fast").children("span").html(t),void 0!==n.notice_timeout_id&&clearTimeout(n.notice_timeout_id),e||(n.notice_timeout_id=setTimeout((function(){$("#close-notice-link").click(),n.notice_timeout_id=void 0}),6e3))},error:function(t){$("#notice").removeClass("ui-state-highlight").addClass("ui-state-error").fadeIn("fast").children("span").html(t),void 0!==n.notice_timeout_id&&clearTimeout(n.notice_timeout_id)},dialog:function(t,e){var a=$(e).dialog({title:t,width:700,modal:!0,close:function(){$((function(){return a.dialog("destroy")}))},buttons:{Submit:function(){a.find("form").submit()},Cancel:function(){a.dialog("close")}}});a.find("form").on("submit.danbooru",(function(){a.dialog("close")}))},disableShortcuts:!1,disableShortcutsWrapper:function(t){return function(e){n.disableShortcuts||t(e)}},keydown:function(t,e,a){"true"===n.meta("enable-js-navigation")&&($(document).off("keydown.danbooru."+e),$(document).on("keydown.danbooru."+e,null,t,n.disableShortcutsWrapper(a)))},is_subset:function(t,e){var a=!0;return $.each(e,(function(e,n){-1===$.inArray(n,t)&&(a=!1)})),a},intersect:function(t,e){t=t.slice(0).sort(),e=e.slice(0).sort();for(var a=[];t.length>0&&e.length>0;)t[0]<e[0]?t.shift():(t[0]>e[0]||a.push(t.shift()),e.shift());return a},regexp_escape:function(t){return t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}};$.fn.selectEnd=function(){return this.each((function(){this.focus(),this.setSelectionRange(this.value.length,this.value.length)}))},$((function(){$(window).on("danbooru:notice",(function(t,e){n.notice(e)})),$(window).on("danbooru:error",(function(t,e){n.error(e)}))})),e.default=n},238:function(t,e,a){"use strict";a.r(e);var n=a(8505);function i(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._type=e,this.allSelected=!1,this.init()}var e,a,o;return e=t,(a=[{key:"init",value:function(){var t=this;t.lastSelected=0,$("#votes").on("click","tbody tr",(function(e){e.preventDefault(),e.shiftKey&&t.toggleRowsBetween([t.lastSelected,this.rowIndex]),$(this).toggleClass("selected"),t.lastSelected=this.rowIndex})),$("#select-all-votes").on("click",(function(){return t.selectAll()})),$("#lock-votes").on("click",(function(){return t.lockVotes()})),$("#delete-votes").on("click",(function(){return t.deleteVotes()}))}},{key:"selectAll",value:function(){this.allSelected=!this.allSelected,this.allSelected?$("#votes").find("tr").addClass("selected"):$("#votes").find("tr").removeClass("selected")}},{key:"toggleRowsBetween",value:function(t){this.lastSelected=t[1];var e=$("#votes").find("tr");t=t.sort(),(e=e.slice(t[0],t[1])).toggleClass("selected")}},{key:"selectedVotes",value:function(){return $("#votes>tbody>tr.selected").map((function(){return $(this).attr("id").substr(1)})).get()}},{key:"lockVotes",value:function(){var t=this,e=this.selectedVotes();e.length&&$.ajax({url:"/".concat(this._type,"_votes/lock.json"),method:"post",data:{ids:e.join(",")}}).done((function(){n.default.notice("".concat(t._type," votes locked."))}))}},{key:"deleteVotes",value:function(){var t=this,e=this.selectedVotes();e.length&&$.ajax({url:"/".concat(this._type,"_votes/delete.json"),method:"post",data:{ids:e.join(",")}}).done((function(){n.default.notice("".concat(t._type," votes deleted."))}))}}])&&i(e.prototype,a),o&&i(e,o),t}();e.default=o},6989:function(){!function(t){function e(e){if("string"===typeof e.data&&(e.data={keys:e.data}),e.data&&e.data.keys&&"string"===typeof e.data.keys){var a=e.handler,n=e.data.keys.toLowerCase().split(" ");e.handler=function(e){if(this===e.target||!(t.hotkeys.options.filterInputAcceptingElements&&t.hotkeys.textInputTypes.test(e.target.nodeName)||t.hotkeys.options.filterContentEditable&&t(e.target).attr("contenteditable")||t.hotkeys.options.filterTextInputs&&t.inArray(e.target.type,t.hotkeys.textAcceptingInputTypes)>-1)){var i="keypress"!==e.type&&t.hotkeys.specialKeys[e.which],o=String.fromCharCode(e.which).toLowerCase(),r="",s={};t.each(["alt","ctrl","shift"],(function(t,a){e[a+"Key"]&&i!==a&&(r+=a+"+")})),e.metaKey&&!e.ctrlKey&&"meta"!==i&&(r+="meta+"),e.metaKey&&"meta"!==i&&r.indexOf("alt+ctrl+shift+")>-1&&(r=r.replace("alt+ctrl+shift+","hyper+")),i?s[r+i]=!0:(s[r+o]=!0,s[r+t.hotkeys.shiftNums[o]]=!0,"shift+"===r&&(s[t.hotkeys.shiftNums[o]]=!0));for(var l=0,c=n.length;l<c;l++)if(s[n[l]])return a.apply(this,arguments)}}}}t.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},textAcceptingInputTypes:["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"],textInputTypes:/textarea|input|select/i,options:{filterInputAcceptingElements:!0,filterTextInputs:!0,filterContentEditable:!0}},t.each(["keydown","keyup","keypress"],(function(){t.event.special[this]={add:e}}))}(jQuery||this.jQuery||window.jQuery)},1995:function(t,e,a){"use strict";function n(t){this.op=t,this._URL=window.URL||window.webkitURL||window.MozURL||window.MSURL,this._Blob=window.Blob||window.WebKitBlob||window.MozBlob||window.MSBlob,this._BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,this._Uint8Array=window.Uint8Array||window.WebKitUint8Array||window.MozUint8Array||window.MSUint8Array,this._DataView=window.DataView||window.WebKitDataView||window.MozDataView||window.MSDataView,this._ArrayBuffer=window.ArrayBuffer||window.WebKitArrayBuffer||window.MozArrayBuffer||window.MSArrayBuffer,this._maxLoadAhead=0,this._URL||(this._debugLog("No URL support! Will use slower data: URLs."),this._maxLoadAhead=10),this._Blob||this._error("No Blob support"),this._Uint8Array||this._error("No Uint8Array support"),this._DataView||this._error("No DataView support"),this._ArrayBuffer||this._error("No ArrayBuffer support"),this._isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,this._loadingState=0,this._dead=!1,this._context=t.canvas.getContext("2d"),this._files={},this._frameCount=this.op.metadata.frames.length,this._debugLog("Frame count: "+this._frameCount),this._frame=0,this._loadFrame=0,this._frameImages=[],this._paused=!1,this._loadTimer=null,this._startLoad(),this.op.autoStart?this.play():this._paused=!0}a.r(e),a.d(e,{ZipImagePlayer:function(){return n}}),n.prototype={_trailerBytes:3e4,_failed:!1,_mkerr:function(t){var e=this;return function(){e._error(t)}},_error:function(t){throw this._failed=!0,Error("ZipImagePlayer error: "+t)},_debugLog:function(t){this.op.debug&&console.log(t)},_load:function(t,e,a){var n=this,i=new XMLHttpRequest;if(i.addEventListener("load",(function(o){n._dead||(n._debugLog("Load: "+t+" "+e+" status="+i.status),200==i.status?(n._debugLog("Range disabled or unsupported, complete load"),t=0,e=i.response.byteLength,n._len=e,n._buf=i.response,n._bytes=new n._Uint8Array(n._buf)):(206!=i.status&&n._error("Unexpected HTTP status "+i.status),i.response.byteLength!=e&&n._error("Unexpected length "+i.response.byteLength+" (expected "+e+")"),n._bytes.set(new n._Uint8Array(i.response),t)),a&&a.apply(n,[t,e]))}),!1),i.addEventListener("error",this._mkerr("Fetch failed"),!1),i.open("GET",this.op.source),i.responseType="arraybuffer",null!=t&&null!=e){var o=t+e;i.setRequestHeader("Range","bytes="+t+"-"+(o-1)),this._isSafari&&(i.setRequestHeader("Cache-control","no-cache"),i.setRequestHeader("If-None-Match",Math.random().toString()))}i.send()},_startLoad:function(){var t=this;this.op.source?$.ajax({url:this.op.source,type:"HEAD"}).done((function(e,a,n){if(!t._dead){t._pHead=0,t._pNextHead=0,t._pFetch=0;var i=parseInt(n.getResponseHeader("Content-Length"));if(!i)return t._debugLog("HEAD request failed: invalid file length."),t._debugLog("Falling back to full file mode."),void t._load(null,null,(function(e,a){t._pTail=0,t._pHead=a,t._findCentralDirectory()}));t._debugLog("Len: "+i),t._len=i,t._buf=new t._ArrayBuffer(i),t._bytes=new t._Uint8Array(t._buf);var o=i-t._trailerBytes;o<0&&(o=0),t._pTail=i,t._load(o,i-o,(function(e,a){t._pTail=e,t._findCentralDirectory()}))}})).fail(this._mkerr("Length fetch failed")):this._loadNextFrame()},_findCentralDirectory:function(){var t=new this._DataView(this._buf,this._len-22,22);101010256!=t.getUint32(0,!0)&&this._error("End of Central Directory signature not found");var e=t.getUint16(10,!0),a=t.getUint32(12,!0),n=t.getUint32(16,!0);n<this._pTail?this._load(n,this._pTail-n,(function(){this._pTail=n,this._readCentralDirectory(n,a,e)})):this._readCentralDirectory(n,a,e)},_readCentralDirectory:function(t,e,a){for(var n=new this._DataView(this._buf,t,e),i=0,o=0;o<a;o++){33639248!=n.getUint32(i,!0)&&this._error("Invalid Central Directory signature");var r=n.getUint16(i+10,!0),s=n.getUint32(i+24,!0),l=n.getUint16(i+28,!0),c=n.getUint16(i+30,!0),d=n.getUint16(i+32,!0),u=n.getUint32(i+42,!0);0!=r&&this._error("Unsupported compression method"),i+=46;for(var p=new this._Uint8Array(this._buf,t+i,l),f="",g=0;g<l;g++)f+=String.fromCharCode(p[g]);i+=l+c+d,this._files[f]={off:u,len:s}}this._pHead>=this._pTail?(this._pHead=this._len,$(this).triggerHandler("loadProgress",[this._pHead/this._len]),this._loadNextFrame()):(this._loadNextChunk(),this._loadNextChunk())},_loadNextChunk:function(){if(!(this._pFetch>=this._pTail)){var t=this._pFetch,e=this.op.chunkSize;this._pFetch+e>this._pTail&&(e=this._pTail-this._pFetch),this._pFetch+=e,this._load(t,e,(function(){t==this._pHead?(this._pNextHead?(this._pHead=this._pNextHead,this._pNextHead=0):this._pHead=t+e,this._pHead>=this._pTail&&(this._pHead=this._len),$(this).triggerHandler("loadProgress",[this._pHead/this._len]),this._loadTimer||this._loadNextFrame()):this._pNextHead=t+e,this._loadNextChunk()}))}},_fileDataStart:function(t){var e=new DataView(this._buf,t,30);return t+30+e.getUint16(26,!0)+e.getUint16(28,!0)},_isFileAvailable:function(t){var e=this._files[t];return e||this._error("File "+t+" not found in ZIP"),!(this._pHead<e.off+30)&&this._pHead>=this._fileDataStart(e.off)+e.len},_loadNextFrame:function(){if(!this._dead){var t=this._loadFrame;if(!(t>=this._frameCount)){var e=this.op.metadata.frames[t];if(!this.op.source)return this._loadFrame+=1,void this._loadImage(t,e.file,!1);if(this._isFileAvailable(e.file)){this._loadFrame+=1;var a,n=this._fileDataStart(this._files[e.file].off),i=n+this._files[e.file].len,o=this.op.metadata.mime_type||"image/png";if(this._URL){var r,s;if(this._buf.slice)r=this._buf.slice(n,i);else r=new this._ArrayBuffer(this._files[e.file].len),new this._Uint8Array(r).set(this._bytes.subarray(n,i));try{s=new this._Blob([r],{type:o})}catch(c){this._debugLog("Blob constructor failed. Trying BlobBuilder... ("+c.message+")");var l=new this._BlobBuilder;l.append(r),s=l.getBlob()}a=this._URL.createObjectURL(s),this._loadImage(t,a,!0)}else a="data:"+o+";base64,"+function(t,e,a){for(var n,i="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(t),s=a%3,l=e+a-s,c=e;c<l;c+=3)i+=o[(16515072&(n=r[c]<<16|r[c+1]<<8|r[c+2]))>>18]+o[(258048&n)>>12]+o[(4032&n)>>6]+o[63&n];return 1==s?i+=o[(252&(n=r[l]))>>2]+o[(3&n)<<4]+"==":2==s&&(i+=o[(64512&(n=r[l]<<8|r[l+1]))>>10]+o[(1008&n)>>4]+o[(15&n)<<2]+"="),i}(this._buf,n,i-n),this._loadImage(t,a,!1)}}}},_loadImage:function(t,e,a){var n=this,i=new Image,o=this.op.metadata.frames[t];i.addEventListener("load",(function(){n._debugLog("Loaded "+o.file+" to frame "+t),a&&n._URL.revokeObjectURL(e),n._dead||(n._frameImages[t]=i,$(n).triggerHandler("frameLoaded",t),0==n._loadingState&&n._displayFrame.apply(n),t>=n._frameCount-1?(n._setLoadingState(2),n._buf=null,n._bytes=null):!n._maxLoadAhead||t-n._frame<n._maxLoadAhead?n._loadNextFrame():n._loadTimer||(n._loadTimer=setTimeout((function(){n._loadTimer=null,n._loadNextFrame()}),200)))})),i.src=e},_setLoadingState:function(t){this._loadingState!=t&&(this._loadingState=t,$(this).triggerHandler("loadingStateChanged",[t]))},_displayFrame:function(){if(!this._dead){var t=this,e=this.op.metadata.frames[this._frame];this._debugLog("Displaying frame: "+this._frame+" "+e.file);var a=this._frameImages[this._frame];if(!a)return this._debugLog("Image not available!"),void this._setLoadingState(0);2!=this._loadingState&&this._setLoadingState(1),this.op.autosize&&(this._context.canvas.width==a.width&&this._context.canvas.height==a.height||(this._context.canvas.width=a.width,this._context.canvas.height=a.height)),this._context.clearRect(0,0,this.op.canvas.width,this.op.canvas.height),this._context.drawImage(a,0,0),$(this).triggerHandler("frame",this._frame),this._paused||(this._timer=setTimeout((function(){t._timer=null,t._nextFrame.apply(t)}),e.delay))}},_nextFrame:function(t){if(this._frame>=this._frameCount-1){if(!this.op.loop)return void this.pause();this._frame=0}else this._frame+=1;this._displayFrame()},play:function(){this._dead||this._paused&&($(this).triggerHandler("play",[this._frame]),this._paused=!1,this._displayFrame())},pause:function(){this._dead||this._paused||(this._timer&&clearTimeout(this._timer),this._paused=!0,$(this).triggerHandler("pause",[this._frame]))},rewind:function(){this._dead||(this._frame=0,this._timer&&clearTimeout(this._timer),this._displayFrame())},stop:function(){this._debugLog("Stopped!"),this._dead=!0,this._timer&&clearTimeout(this._timer),this._loadTimer&&clearTimeout(this._loadTimer),this._frameImages=null,this._buf=null,this._bytes=null,$(this).triggerHandler("stop")},getCurrentFrame:function(){return this._frame},getLoadedFrames:function(){return this._frameImages.length},getFrameCount:function(){return this._frameCount},hasError:function(){return this._failed}}},3080:function(){!function(t){t.fn.stupidtable=function(e){return this.each((function(){var a=t(this);e=e||{},e=t.extend({},t.fn.stupidtable.default_sort_fns,e),a.data("sortFns",e),a.stupidtable_build(),a.on("click.stupidtable","thead th",(function(){t(this).stupidsort()})),a.find("th[data-sort-onload=yes]").eq(0).stupidsort()}))},t.fn.stupidtable.default_settings={should_redraw:function(t){return!0},will_manually_build_table:!1},t.fn.stupidtable.dir={ASC:"asc",DESC:"desc"},t.fn.stupidtable.default_sort_fns={int:function(t,e){return parseInt(t,10)-parseInt(e,10)},float:function(t,e){return parseFloat(t)-parseFloat(e)},string:function(t,e){return t.toString().localeCompare(e.toString())},"string-ins":function(t,e){return t=t.toString().toLocaleLowerCase(),e=e.toString().toLocaleLowerCase(),t.localeCompare(e)}},t.fn.stupidtable_settings=function(e){return this.each((function(){var a=t(this),n=t.extend({},t.fn.stupidtable.default_settings,e);a.stupidtable.settings=n}))},t.fn.stupidsort=function(a){var s=t(this),l=s.data("sort")||null;if(null!==l){t.fn.stupidtable.dir;var c=s.closest("table"),d={$th:s,$table:c,datatype:l};return c.stupidtable.settings||(c.stupidtable.settings=t.extend({},t.fn.stupidtable.default_settings)),d.compare_fn=c.data("sortFns")[l],d.th_index=r(d),d.sort_dir=o(a,d),s.data("sort-dir",d.sort_dir),c.trigger("beforetablesort",{column:d.th_index,direction:d.sort_dir,$th:s}),c.css("display"),setTimeout((function(){c.stupidtable.settings.will_manually_build_table||c.stupidtable_build();var t=e(d),a=n(t,d);c.stupidtable.settings.should_redraw(d)&&(c.children("tbody").append(a),i(d),c.trigger("aftertablesort",{column:d.th_index,direction:d.sort_dir,$th:s}),c.css("display"))}),10),s}},t.fn.updateSortVal=function(e){var a=t(this);return a.is("[data-sort-value]")&&a.attr("data-sort-value",e),a.data("sort-value",e),a},t.fn.stupidtable_build=function(){return this.each((function(){var e=t(this),a=[];e.children("tbody").children("tr").each((function(e,n){var i={$tr:t(n),columns:[],index:e};t(n).children("td").each((function(e,a){var n=t(a).data("sort-value");if("undefined"===typeof n){var o=t(a).text();t(a).data("sort-value",o),n=o}i.columns.push(n)})),a.push(i)})),e.data("stupidsort_internaltable",a)}))};var e=function(e){var n,i=e.$table.data("stupidsort_internaltable"),o=e.th_index,r=e.$th.data("sort-multicolumn");n=r?r.split(","):[];var s=t.map(n,(function(t,n){return a(e.$table,t)}));return i.sort((function(t,a){for(var n=s.slice(0),i=e.compare_fn(t.columns[o],a.columns[o]);0===i&&n.length;){var r=n[0],l=r.$e.data("sort");i=(0,e.$table.data("sortFns")[l])(t.columns[r.index],a.columns[r.index]),n.shift()}return 0===i?t.index-a.index:i})),e.sort_dir!=t.fn.stupidtable.dir.ASC&&i.reverse(),i},a=function(t,e){var a,n=t.find("th"),i=parseInt(e,10);return i||0===i?a=n.eq(i):(a=n.siblings("#"+e),i=n.index(a)),{index:i,$e:a}},n=function(e,a){var n=t.map(e,(function(t,e){return[[t.columns[a.th_index],t.$tr,e]]}));return a.column=n,t.map(e,(function(t){return t.$tr}))},i=function(t){var e=t.$table,a=t.$th,n=a.data("sort-dir");t.th_index;e.find("th").data("sort-dir",null).removeClass("sorting-desc sorting-asc"),a.data("sort-dir",n).addClass("sorting-"+n)},o=function(e,a){var n,i=a.$th,o=t.fn.stupidtable.dir;return e?n=e:(n=e||i.data("sort-default")||o.ASC,i.data("sort-dir")&&(n=i.data("sort-dir")===o.ASC?o.DESC:o.ASC)),n},r=function(e){var a=0,n=e.$th.index();return e.$th.parents("tr").find("th").slice(0,n).each((function(){var e=t(this).attr("colspan")||1;a+=parseInt(e,10)})),a}}(jQuery)},5903:function(t,e,a){"use strict";a.r(e);var n=a(8505),i={METATAGS:["-user","user","-approver","approver","commenter","comm","noter","noteupdater","artcomm","-pool","pool","ordpool","-fav","fav","-favoritedby","favoritedby","md5","-rating","rating","note","-note","-locked","locked","width","height","mpixels","ratio","score","favcount","filesize","source","-source","id","-id","date","age","order","limit","-status","status","tagcount","parent","-parent","child","pixiv_id","pixiv","search","upvote","downvote","voted","filetype","-filetype","flagger","type","-type","-flagger","appealer","-appealer","disapproval","-disapproval","set","-set","randseed","-voted","-upvote","-downvote","description","-description","change","-user_id","user_id","delreason","-delreason","deletedby","-deletedby","votedup","voteddown","-votedup","-voteddown","duration","gentags","spectags","chartags","copytags","arttags","invtags","lortags","metatags","comment_count","note_count","flag_count","child_count","pool_count","hassource","hasdescription","ratinglocked","notelocked","statuslocked","tagslocked","hideanon","hidegoogle","isparent","ischild","inpool","pending_replacements"],TAG_CATEGORIES:{ch:4,co:3,gen:0,spec:5,char:4,copy:3,art:1,inv:6,lor:8,meta:7,general:0,species:5,character:4,copyright:3,artist:1,invalid:6,lore:8},ORDER_METATAGS:["id","id_desc","score","score_asc","favcount","favcount_asc","created_at","created_at_asc","updated","updated_desc","updated_asc","comment","comment_asc","comment_bumped","comment_bumped_asc","note","note_asc","artcomm","artcomm_asc","mpixels","mpixels_asc","portrait","landscape","filesize","filesize_asc","tagcount","tagcount_asc","change","change_desc","change_asc","duration","duration_desc","duration_asc","rank","random","custom","comment_count","note_count","flag_count","child_count","pool_count","gentags","gentags_asc","spectags","spectags_asc","chartags","chartags_asc","copytags","copytags_asc","arttags","arttags_asc","invtags","invtags_asc","lortags","lortags_asc","metatags","metatags_asc"]};i.TAG_PREFIXES="-|~|"+Object.keys(i.TAG_CATEGORIES).map((function(t){return t+":"})).join("|"),i.TAG_PREFIXES_REGEX=new RegExp("^("+i.TAG_PREFIXES+")(.*)$","i"),i.METATAGS_REGEX=new RegExp("^("+i.METATAGS.join("|")+"):(.*)$","i"),i.initialize_all=function(){"true"===n.default.meta("enable-auto-complete")&&($.widget("ui.autocomplete",$.ui.autocomplete,{options:{delay:225,minLength:3,autoFocus:!1,focus:function(){return!1}},_create:function(){this.element.on("keydown.Autocomplete.tab",null,"tab",i.on_tab),this._super()},_renderItem:i.render_item}),this.initialize_tag_autocomplete(),this.initialize_artist_autocomplete($('[data-autocomplete="artist"]')),this.initialize_pool_autocomplete($('[data-autocomplete="pool"]')),this.initialize_user_autocomplete($('[data-autocomplete="user"]')),this.initialize_wiki_autocomplete($('[data-autocomplete="wiki-page"]')))},i.initialize_tag_autocomplete=function(){var t=$('[data-autocomplete="tag-query"], [data-autocomplete="tag-edit"]'),e=$('[data-autocomplete="tag"]');t.autocomplete({search:function(){$(this).data("ui-autocomplete")&&($(this).data("ui-autocomplete").menu.bindings=$())},select:function(t,e){return"Enter"===t.key&&t.stopImmediatePropagation(),i.insert_completion(this,e.item.value),!1},source:function(t,e){var a=i.parse_query(t.term,this.element.get(0).selectionStart),n=a.metatag,o=a.term;if(n||o)switch(n){case"md5":case"width":case"height":case"mpixels":case"ratio":case"score":case"duration":case"favcount":case"filesize":case"source":case"id":case"date":case"age":case"limit":case"tagcount":case"gentags":case"spectags":case"chartags":case"copytags":case"arttags":case"invtags":case"lortags":case"metatags":return void e([]);case"order":case"status":case"rating":case"locked":case"child":case"parent":case"filetype":case"type":case"disapproval":return void i.static_metatag_source(o,e,n);case"user":case"approver":case"commenter":case"comm":case"noter":case"noteupdater":case"artcomm":case"fav":case"favoritedby":case"appealer":case"flagger":case"upvote":case"downvote":i.user_source(o,e,n+":");break;case"pool":i.pool_source(o,e,n);break;default:i.normal_source(o,e)}else this.close()}}),e.autocomplete({search:function(){$(this).data("ui-autocomplete").menu.bindings=$()},source:function(t,e){i.normal_source(t.term,e)}})},i.initialize_artist_autocomplete=function(t){t.autocomplete({search:function(){$(this).data("ui-autocomplete").menu.bindings=$()},source:function(t,e){i.artist_source(t.term,e)}})},i.initialize_pool_autocomplete=function(t){t.autocomplete({search:function(){$(this).data("ui-autocomplete").menu.bindings=$()},source:function(t,e){i.pool_source(t.term,e)}})},i.initialize_user_autocomplete=function(t){t.autocomplete({search:function(){$(this).data("ui-autocomplete").menu.bindings=$()},source:function(t,e){i.user_source(t.term,e,"")}})},i.initialize_wiki_autocomplete=function(t){t.autocomplete({search:function(){$(this).data("ui-autocomplete").menu.bindings=$()},source:function(t,e){i.wiki_source(t.term,e)}})},i.parse_query=function(t,e){var a="",n="",o=t.substring(0,e).match(/\S+$/g);return o?((o=(n=o[0]).match(i.TAG_PREFIXES_REGEX))&&(a=o[1].toLowerCase(),n=o[2]),(o=n.match(i.METATAGS_REGEX))&&(a=o[1].toLowerCase(),n=o[2]),{metatag:a,term:n}):{}},i.insert_completion=function(t,e){var a=t.value.substring(0,t.selectionStart).trim(),n=t.value.substring(t.selectionStart).trim(),o=new RegExp("("+i.TAG_PREFIXES+")?\\S+$","g");a=a.replace(o,"$1")+e,(0===n.length||0!==n.length&&!n.startsWith(" "))&&(a+=" "),t.value=a+n,t.selectionStart=a.length,t.selectionEnd=a.length;var r=new Event("input",{bubbles:!0});t.dispatchEvent(r)},i.on_tab=function(t){var e=$(this).autocomplete("instance"),a=e.menu.element;if(a.is(":visible")){if(0===a.has(".ui-state-active").length){var n=a.find(".ui-menu-item").first().data().uiAutocompleteItem.value;i.insert_completion(this,n),e.close()}t.preventDefault()}},i.render_item=function(t,e){var a=$("<a/>");if(a.text(e.label),a.attr("href",i.get_href(e)),a.on("click.danbooru",(function(t){t.preventDefault()})),e.antecedent){var o=e.antecedent.replace(/_/g," "),r=$("<span/>").html(" &rarr; ").addClass("autocomplete-arrow"),s=$("<span/>").text(o).addClass("autocomplete-antecedent");a.prepend([s,r])}if(void 0!==e.post_count){var l=e.post_count;l>=1e3&&(l=Math.floor(l/1e3)+"k");var c=$("<span/>").addClass("post-count").css("float","right").text(l);a.append(c)}if("tag"===e.type)a.addClass("tag-type-"+e.category);else if("user"===e.type){var d="user-"+e.level.toLowerCase();a.addClass(d),"true"===n.default.meta("style-usernames")&&a.addClass("with-style")}else"pool"===e.type&&a.addClass("pool-category-"+e.category);var u=$("<div/>").append(a),p=$("<li/>").data("item.autocomplete",e).append(u);return["id","type","source","antecedent","value","category","post_count","weight"].forEach((function(t){p.attr("data-autocomplete-".concat(t.replace(/_/g,"-")),e[t])})),p.appendTo(t)},i.get_href=function(t){switch(t.type){case"user":return"/users/"+t.id;case"pool":return"/pools/"+t.id;case"artist":return"/artists/"+t.id;case"wiki_page":return"/wiki_pages/"+t.id;default:return"/posts?tags="+encodeURIComponent(t.value)}},i.normal_source=function(t,e){if(!(t.length<3))return $.ajax({url:"/tags/autocomplete.json",data:{"search[name_matches]":t,expiry:7},method:"get",success:function(t){var a=$.map(t,(function(t){return{id:t.id,type:"tag",label:t.name.replace(/_/g," "),antecedent:t.antecedent_name,value:t.name,category:t.category,source:t.source,weight:t.weight,post_count:t.post_count}}));e(a)}})},i.static_metatags={order:i.ORDER_METATAGS,status:["any","deleted","active","pending","flagged","modqueue","unmoderated"],rating:["safe","questionable","explicit"],locked:["rating","note","status"],child:["any","none"],parent:["any","none"],filetype:["jpg","png","gif","swf","zip","webm","mp4"],type:["jpg","png","gif","swf","zip","webm","mp4"],disapproval:["any","none","borderline_quality","borderline_relevancy","other"]},i.static_metatag_source=function(t,e,a){var n=this.static_metatags[a].filter((function(e){return e.startsWith(t.toLowerCase())}));e(n=n.map((function(t){return"".concat(a,":").concat(t)})).sort().slice(0,10))},i.user_source=function(t,e,a){return $.ajax({url:"/users.json",data:{"search[order]":"post_upload_count","search[name_matches]":t+"*",limit:10},method:"get",success:function(t){e($.map(t,(function(t){return{id:t.id,type:"user",label:t.name.replace(/_/," "),value:a+t.name,level:t.level_string}})))}})},i.pool_source=function(t,e,a){return $.ajax({url:"/pools.json",data:{"search[order]":"post_count","search[name_matches]":t,limit:10},method:"get",success:function(t){e($.map(t,(function(t){return{id:t.id,type:"pool",label:t.name.replace(/_/g," "),value:a?a+":"+t.name:t.name,post_count:t.post_count,category:t.category}})))}})},i.artist_source=function(t,e){return $.ajax({url:"/artists.json",data:{"search[name_like]":t.trim().replace(/\s+/g,"_")+"*","search[is_active]":!0,"search[order]":"post_count",limit:10,expiry:7},method:"get",success:function(t){e($.map(t,(function(t){return{id:t.id,type:"artist",label:t.name.replace(/_/g," "),value:t.name,category:i.TAG_CATEGORIES.artist}})))}})},i.wiki_source=function(t,e){return $.ajax({url:"/wiki_pages.json",data:{"search[title]":t+"*","search[hide_deleted]":"Yes","search[order]":"post_count",limit:10,expiry:7},method:"get",success:function(t){e($.map(t,(function(t){return{id:t.id,type:"wiki_page",label:t.title.replace(/_/g," "),value:t.title,category:t.category_name}})))}})},$(document).ready((function(){i.initialize_all()})),e.default=i},5397:function(t,e,a){"use strict";a.r(e)},2453:function(t,e,a){"use strict";a.d(e,{Z:function(){return o}});function n(t,e){return t[0]>e[0]?1:-1}var i={props:["tags","related","loading"],data:function(){return{uploaded:window.uploaderSettings.uploadTags||[],recent:(window.uploaderSettings.recentTags||[]).sort(n),artists:(window.uploaderSettings.artistTags||[]).sort(n)}},methods:{toggle:function(t){this.$emit("tag-active",t[0],!this.tagActive(t))},tagLink:function(t){return"/wiki_pages/show_or_new?title="+encodeURIComponent(t[0])},tagActive:function(t){return-1!==this.tags.indexOf(t[0])},tagClasses:function(t){var e={"tag-active":this.tagActive(t)};return e["tag-type-"+t[2]]=!0,e},splitTags:function(t){return function(t,e){for(var a=[],n=0;n<t.length;n+=e)a.push(t.slice(n,n+e));return a}(t,15)}},computed:{tagGroups:{get:function(){var t=[];if(this.uploaded&&this.uploaded.length&&t.push({title:"Quick Tags",tags:this.uploaded}),this.recent&&this.recent.length&&t.push({title:"Recent",tags:this.recent}),this.artists&&this.artists.length&&t.push({title:"Artists",tags:this.artists}),this.related&&this.related.length)for(var e=0;e<this.related.length;e++)t.push(this.related[e]);return this.loading&&t.push({title:"Loading Related Tags",tags:[["","",""]]}),t}}}},o=(0,a(1900).Z)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"related-tags flex-wrap"},t._l(t.tagGroups,(function(e){return a("div",{key:e.title,staticClass:"related-section"},t._l(t.splitTags(e.tags),(function(n,i){return a("div",{key:i,staticClass:"related-items"},[0===i?a("div",{staticClass:"related-title"},[t._v(t._s(e.title))]):t._e(),t._v(" "),t._l(n,(function(e){return a("div",{key:e[0],staticClass:"related-item"},[a("a",{class:t.tagClasses(e),attrs:{href:t.tagLink(e)},on:{click:function(a){return a.preventDefault(),t.toggle(e)}}},[t._v(t._s(e[0]))])])}))],2)})),0)})),0)}),[],!1,null,null,null).exports},3269:function(t,e,a){"use strict";a.d(e,{Z:function(){return o}});var n={props:["tags","loading"],components:{"tag-preview":a(144).Z.extend({functional:!0,props:["tag"],render:function(t,e){function a(e,a){return t("a",{staticClass:"tag-type-"+a,attrs:{href:"/wiki_pages/show_or_new?title="+e,target:"_blank"}},e)}var n=e.props.tag;switch(n.type){default:return t("span",{staticClass:"tag-preview"},[a(n.a,n.tagTypeA)]);case"alias":return t("span",{staticClass:"tag-preview tag-preview-alias"},[t("del",void 0,[a(n.a,n.tagTypeA)])," \u2192 ",a(n.b,n.tagTypeB)]);case"implication":return t("span",{staticClass:"tag-preview tag-preview-implication"},[a(n.a,n.tagTypeA)," \u21d0 ",a(n.b,n.tagTypeB)])}}})},methods:{close:function(){this.$emit("close")}},computed:{splitTags:function(){var t=this.tags.concat([]);t.sort((function(t,e){return t.a===e.a?0:t.a<e.a?-1:1}));return function(t,e){for(var a=[],n=0;n<t.length;n+=e)a.push(t.slice(n,n+e));return a}(t,15)}}},i=(0,a(1900).Z)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}]},[t._v("Fetching tags...")]),t._v(" "),a("div",{staticClass:"related-tags flex-wrap"},t._l(t.splitTags,(function(e,n){return a("div",{key:n,staticClass:"related-items"},t._l(e,(function(t,e){return a("tag-preview",{key:e,attrs:{tag:t}})})),1)})),0),t._v(" "),a("div",[a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.close.apply(null,arguments)}}},[t._v("Close Preview")])])])}),[],!1,null,null,null),o=i.exports},5311:function(t){"use strict";t.exports=jQuery}},a={};function n(t){var i=a[t];if(void 0!==i)return i.exports;var o=a[t]={exports:{}};return e[t].call(o.exports,o,o.exports,n),o.exports}n.m=e,t=[],n.O=function(e,a,i,o){if(!a){var r=1/0;for(d=0;d<t.length;d++){a=t[d][0],i=t[d][1],o=t[d][2];for(var s=!0,l=0;l<a.length;l++)(!1&o||r>=o)&&Object.keys(n.O).every((function(t){return n.O[t](a[l])}))?a.splice(l--,1):(s=!1,o<r&&(r=o));if(s){t.splice(d--,1);var c=i();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[a,i,o]},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},function(){var t={34:0};n.O.j=function(e){return 0===t[e]};var e=function(e,a){var i,o,r=a[0],s=a[1],l=a[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(l)var d=l(n)}for(e&&e(a);c<r.length;c++)o=r[c],n.o(t,o)&&t[o]&&t[o][0](),t[r[c]]=0;return n.O(d)},a=self.webpackChunkDanbooru=self.webpackChunkDanbooru||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var i=n.O(void 0,[534],(function(){return n(8818)}));i=n.O(i),Danbooru=i}();